<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geva Kipper's Portfolio - 3D Room Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <style>
        :root {
            --primary-color: #0a192f;
            --secondary-color: #112240;
            --accent-color: #64ffda;
            --text-color: #e6f1ff;
            --text-secondary: #8892b0;
            --header-font: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --body-font: 'Arial', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--body-font);
            background-color: var(--primary-color);
            color: var(--text-color);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--primary-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 1.5s ease-in-out;
        }

        h1 {
            font-family: var(--header-font);
            font-size: 3.5rem;
            font-weight: 600;
            letter-spacing: 1px;
            animation: fadeIn 2s;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-top: 10px;
            animation: fadeIn 2s 0.5s both;
        }

        .small-subtitle {
            font-size: 0.9rem;
            color: var(--accent-color);
            margin-top: 20px;
            animation: fadeIn 2s 1s both;
            text-align: center;
            max-width: 80%;
        }

        .enter-button {
            margin-top: 40px;
            padding: 12px 24px;
            background: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            animation: fadeIn 2s 1.5s both;
        }

        .enter-button:hover {
            background-color: rgba(100, 255, 218, 0.1);
            transform: translateY(-2px);
        }

        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        #compass {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            background-color: rgba(17, 34, 64, 0.7);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
        }

        #compass-needle {
            width: 60%;
            height: 60%;
            position: relative;
        }

        #compass-needle::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 50%;
            background-color: var(--accent-color);
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(17, 34, 64, 0.7);
            padding: 10px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: auto;
        }

        .control-button {
            background: transparent;
            color: var(--text-color);
            border: 1px solid var(--text-secondary);
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-button:hover {
            background-color: rgba(230, 241, 255, 0.1);
        }

        #footer {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            z-index: 10;
        }

        #footer p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        #stopwatch {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            color: var(--accent-color);
            letter-spacing: 1px;
        }

        #project-details {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 80%;
            max-width: 800px;
            background-color: rgba(10, 25, 47, 0.95);
            border-radius: 10px;
            padding: 30px;
            z-index: 20;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
        }

        #project-details.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .project-title {
            font-size: 2rem;
            margin: 0;
            color: var(--accent-color);
        }

        .close-button {
            background: transparent;
            color: var(--text-color);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .project-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .project-description {
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .project-media {
            width: 100%;
            border-radius: 5px;
            overflow: hidden;
        }

        .project-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .project-link {
            padding: 10px 20px;
            background-color: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .project-link:hover {
            background-color: rgba(100, 255, 218, 0.1);
            transform: translateY(-2px);
        }

        #loading-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--primary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        #mobile-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--primary-color);
            z-index: 90;
            overflow-y: auto;
            padding: 20px;
        }

        .mobile-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .mobile-title {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .mobile-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .room-dollhouse {
            width: 100%;
            height: 200px;
            background-color: var(--secondary-color);
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .project-card {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .project-card:hover {
            transform: translateY(-5px);
        }

        .project-card h3 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .social-links {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .social-link {
            color: var(--text-color);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s;
        }

        .social-link:hover {
            transform: translateY(-3px);
            color: var(--accent-color);
        }

        .social-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            #mobile-view {
                display: block;
            }
            #canvas-container, #ui-overlay {
                display: none;
            }
            #intro-overlay {
                display: none;
            }
            h1 {
                font-size: 2rem;
            }
            .subtitle {
                font-size: 1rem;
            }
            #footer {
                position: relative;
                margin-top: 40px;
                right: 0;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div id="loading-indicator">
        <div class="spinner"></div>
    </div>

    <div id="intro-overlay">
        <h1>Geva Kipper</h1>
        <p class="subtitle">Currently developing AI solutions at Google</p>
        <p class="small-subtitle">This portfolio room is redesigned daily by AI - what you see is unique to today</p>
        <button class="enter-button" id="enter-button">Enter the Room</button>
    </div>

    <div id="canvas-container"></div>

    <div id="ui-overlay">
        <div id="compass">
            <div id="compass-needle"></div>
        </div>

        <div id="controls">
            <button class="control-button" id="sound-toggle">
                <span class="icon">🔊</span> Sound: On
            </button>
            <button class="control-button" id="help-button">
                <span class="icon">❓</span> Help
            </button>
        </div>

        <div id="project-details">
            <div class="project-header">
                <h2 class="project-title">Project Title</h2>
                <button class="close-button">&times;</button>
            </div>
            <div class="project-content">
                <p class="project-description">Project description will appear here.</p>
                <div class="project-media" id="project-media">
                    <!-- Media content will be inserted here dynamically -->
                </div>
                <div class="project-links" id="project-links">
                    <!-- Links will be inserted here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <div id="footer">
        <p>Room designed by Portfolio AI</p>
        <div id="stopwatch">00:00:00:00</div>
    </div>

    <div id="mobile-view">
        <div class="mobile-header">
            <h1 class="mobile-title">Geva Kipper</h1>
            <p class="mobile-subtitle">Currently developing AI solutions at Google</p>
            <p class="small-subtitle">This portfolio room is redesigned daily by AI - what you see is unique to today</p>
        </div>
        
        <div class="room-dollhouse">
            <p>3D View available on desktop</p>
        </div>
        
        <div class="projects-grid">
            <div class="project-card" id="tv-project">
                <h3>GlglStats</h3>
                <p>Music visualization statistics project. Learn about real-time audio analysis and visualization.</p>
            </div>
            
            <div class="project-card" id="map-project">
                <h3>Ahuzat Dibuk</h3>
                <p>Tel Aviv parking project with heat map visualization, showcasing urban data analysis.</p>
            </div>
            
            <div class="project-card" id="laptop-project">
                <h3>Portfolio Design</h3>
                <p>Meta reference to this portfolio website, exploring the design approach and technology.</p>
            </div>
        </div>
        
        <div class="social-links">
            <a href="https://github.com/gevak" target="_blank" class="social-link">
                <span class="social-icon">🌟</span>
                <span>GitHub</span>
            </a>
            <a href="https://linkedin.com/in/gevakip" target="_blank" class="social-link">
                <span class="social-icon">🔗</span>
                <span>LinkedIn</span>
            </a>
            <a href="https://facebook.com/geva.kipper" target="_blank" class="social-link">
                <span class="social-icon">📸</span>
                <span>Facebook</span>
            </a>
        </div>
        
        <div id="mobile-footer">
            <p>Room designed by Portfolio AI</p>
            <div id="mobile-stopwatch">00:00:00:00</div>
        </div>
    </div>

    <script>
        // Constants
        const targetDate = new Date('April 2, 2025 01:02:20');
        const projectData = {
            'tv': {
                title: 'GlglStats',
                description: 'GlglStats is a music visualization statistics project that provides real-time analysis of audio data. The system can process audio streams, extract meaningful patterns, and create compelling visual representations of music.',
                media: '<iframe width="100%" height="315" src="https://www.youtube.com/embed/jrKAtOsj1Lo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>',
                links: [
                    { text: 'Visit Website', url: 'https://glglstats.onrender.com/' },
                    { text: 'Watch Presentation', url: 'https://www.youtube.com/watch?v=jrKAtOsj1Lo' }
                ]
            },
            'map': {
                title: 'Ahuzat Dibuk Parking Project',
                description: 'The Ahuzat Dibuk project provides a comprehensive analysis of parking patterns in Tel Aviv. Using heat maps and data visualization techniques, it helps identify parking availability and usage patterns throughout the city.',
                media: '<img src="https://via.placeholder.com/800x400/112240/64ffda?text=Tel+Aviv+Parking+Map" alt="Tel Aviv Parking Map" style="width:100%;">',
                links: [
                    { text: '13TV Media Coverage', url: 'https://13tv.co.il/item/news/domestic/internal/parking-902956407/' },
                    { text: 'Mako News Article', url: 'https://www.mako.co.il/nexter-news/Article-ae43964b891bf71027.htm' },
                    { text: 'Facebook Post', url: 'https://www.facebook.com/groups/secrettelaviv/posts/10159636301195943' }
                ]
            },
            'laptop': {
                title: 'Portfolio Website',
                description: 'This interactive 3D room portfolio showcases my work in an immersive virtual environment. The design adapts to visitor interaction and combines modern web technologies to create a unique browsing experience.',
                media: '<img src="https://via.placeholder.com/800x400/112240/64ffda?text=Interactive+3D+Portfolio" alt="Portfolio Website" style="width:100%;">',
                links: [
                    { text: 'View Portfolio', url: 'https://portfolio-dor1.onrender.com/' },
                ]
            },
            'bookshelf': {
                title: 'Social Profiles',
                description: 'Connect with me on various social platforms to learn more about my work, projects, and interests.',
                media: '<div style="display:flex;justify-content:space-around;padding:20px;"><div style="text-align:center;"><div style="font-size:3rem;">🌟</div><p>GitHub</p></div><div style="text-align:center;"><div style="font-size:3rem;">🔗</div><p>LinkedIn</p></div><div style="text-align:center;"><div style="font-size:3rem;">📸</div><p>Facebook</p></div></div>',
                links: [
                    { text: 'GitHub', url: 'https://github.com/gevak' },
                    { text: 'LinkedIn', url: 'https://linkedin.com/in/gevakip' },
                    { text: 'Facebook', url: 'https://facebook.com/geva.kipper' }
                ]
            }
        };

        // DOM Elements
        const loadingIndicator = document.getElementById('loading-indicator');
        const introOverlay = document.getElementById('intro-overlay');
        const enterButton = document.getElementById('enter-button');
        const canvasContainer = document.getElementById('canvas-container');
        const projectDetails = document.getElementById('project-details');
        const projectTitle = document.querySelector('.project-title');
        const projectDescription = document.querySelector('.project-description');
        const projectMedia = document.getElementById('project-media');
        const projectLinks = document.getElementById('project-links');
        const closeButton = document.querySelector('.close-button');
        const soundToggle = document.getElementById('sound-toggle');
        const helpButton = document.getElementById('help-button');
        const stopwatchElement = document.getElementById('stopwatch');
        const mobileStopwatchElement = document.getElementById('mobile-stopwatch');

        // Mobile elements
        const tvProject = document.getElementById('tv-project');
        const mapProject = document.getElementById('map-project');
        const laptopProject = document.getElementById('laptop-project');

        // Three.js variables
        let scene, camera, renderer, controls;
        let room, tv, cityMap, laptop, bookshelf;
        let raycaster, mouse;
        let ambientSound;
        let isSoundOn = true;
        let clock = new THREE.Clock();
        let interactiveObjects = [];
        let currentIntersect = null;
        
        // Initialize the scene
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a192f);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 3);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            canvasContainer.appendChild(renderer.domElement);
            
            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2;
            controls.minDistance = 1;
            controls.maxDistance = 6;
            
            // Raycaster for object interaction
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            const pointLight = new THREE.PointLight(0x64ffda, 0.8, 10);
            pointLight.position.set(0, 2, 0);
            scene.add(pointLight);
            
            // Create the room and objects
            createRoom();
            
            // Audio setup (simulated)
            ambientSound = new Audio();
            // Would set audio source here in a real implementation
            ambientSound.loop = true;
            ambientSound.volume = 0.3;
            
            // Event listeners
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('click', onClick);
            document.addEventListener('keydown', onKeyDown);
            
            // Hide loading indicator
            loadingIndicator.style.display = 'none';
            
            // Start animation loop
            animate();
        }

        // Create the room and interactive objects
        function createRoom() {
            // Room (simulated with a box)
            const roomGeometry = new THREE.BoxGeometry(10, 6, 10);
            const roomMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x112240,
                side: THREE.BackSide
            });
            room = new THREE.Mesh(roomGeometry, roomMaterial);
            scene.add(room);
            
            // Floor
            const floorGeometry = new THREE.PlaneGeometry(10, 10);
            const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x0c1b33 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -3;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // TV
            const tvGeometry = new THREE.BoxGeometry(2, 1.2, 0.1);
            const tvMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
            tv = new THREE.Mesh(tvGeometry, tvMaterial);
            tv.position.set(0, 1, -4.9);
            tv.name = 'tv';
            scene.add(tv);
            
            // TV Screen (display surface)
            const screenGeometry = new THREE.PlaneGeometry(1.9, 1.1);
            const screenMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x333333,
                emissive: 0x64ffda,
                emissiveIntensity: 0.2
            });
            const screen = new THREE.Mesh(screenGeometry, screenMaterial);
            screen.position.z = 0.06;
            tv.add(screen);
            
            // City Map on Desk
            const mapGeometry = new THREE.BoxGeometry(1.5, 0.05, 1.5);
            const mapMaterial = new THREE.MeshStandardMaterial({ color: 0xcccccc });
            cityMap = new THREE.Mesh(mapGeometry, mapMaterial);
            cityMap.position.set(-2, -1.5, -2);
            cityMap.name = 'map';
            scene.add(cityMap);
            
            // Map details (simple grid pattern)
            const gridGeometry = new THREE.PlaneGeometry(1.4, 1.4);
            const gridTexture = createGridTexture();
            const gridMaterial = new THREE.MeshBasicMaterial({ 
                map: gridTexture,
                transparent: true
            });
            const grid = new THREE.Mesh(gridGeometry, gridMaterial);
            grid.rotation.x = -Math.PI / 2;
            grid.position.y = 0.03;
            cityMap.add(grid);
            
            // Laptop on Desk
            const laptopBaseGeometry = new THREE.BoxGeometry(1, 0.05, 0.8);
            const laptopMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 });
            laptop = new THREE.Group();
            const laptopBase = new THREE.Mesh(laptopBaseGeometry, laptopMaterial);
            laptop.add(laptopBase);
            
            // Laptop Screen
            const laptopScreenGeometry = new THREE.BoxGeometry(0.9, 0.6, 0.02);
            const laptopScreenMaterial = new THREE.MeshBasicMaterial({ color: 0x222222 });
            const laptopScreen = new THREE.Mesh(laptopScreenGeometry, laptopScreenMaterial);
            laptopScreen.position.set(0, 0.35, -0.35);
            laptopScreen.rotation.x = Math.PI / 6;
            laptop.add(laptopScreen);
            
            // Screen Display
            const displayGeometry = new THREE.PlaneGeometry(0.85, 0.55);
            const displayMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x000000,
                emissive: 0x64ffda,
                emissiveIntensity: 0.3
            });
            const display = new THREE.Mesh(displayGeometry, displayMaterial);
            display.position.z = 0.015;
            laptopScreen.add(display);
            
            laptop.position.set(2, -1.5, -2);
            laptop.name = 'laptop';
            scene.add(laptop);
            
            // Digital Bookshelf
            bookshelf = new THREE.Group();
            bookshelf.position.set(4.9, 0, 0);
            bookshelf.rotation.y = -Math.PI / 2;
            bookshelf.name = 'bookshelf';
            
            // Shelf structure
            const shelfGeometry = new THREE.BoxGeometry(4, 3, 0.2);
            const shelfMaterial = new THREE.MeshStandardMaterial({ color: 0x5c2f17 });
            const shelfBack = new THREE.Mesh(shelfGeometry, shelfMaterial);
            bookshelf.add(shelfBack);
            
            // Create books/items for social profiles
            const socialProfiles = ['github', 'linkedin', 'facebook'];
            const socialColors = [0x171515, 0x0077b5, 0x4267B2];
            
            for (let i = 0; i < socialProfiles.length; i++) {
                const itemGeometry = new THREE.BoxGeometry(0.7, 0.8, 0.5);
                const itemMaterial = new THREE.MeshStandardMaterial({ 
                    color: socialColors[i],
                    emissive: socialColors[i],
                    emissiveIntensity: 0.2
                });
                const item = new THREE.Mesh(itemGeometry, itemMaterial);
                item.position.set(i * 1 - 1, 0, 0.2);
                bookshelf.add(item);
            }
            
            scene.add(bookshelf);
            
            // Add objects to interactive list
            interactiveObjects = [tv, cityMap, laptop, bookshelf];
        }

        // Create a simple grid texture for the map
        function createGridTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');
            
            // Background
            ctx.fillStyle = '#1a394d';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Grid lines
            ctx.strokeStyle = '#64ffda';
            ctx.lineWidth = 1;
            
            // Draw grid
            const gridSize = 32;
            for (let i = 0; i <= canvas.width; i += gridSize) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            // Draw some "heat" spots
            const heatSpots = [
                {x: 150, y: 200, radius: 70},
                {x: 320, y: 180, radius: 50},
                {x: 250, y: 350, radius: 80}
            ];
            
            for (const spot of heatSpots) {
                const gradient = ctx.createRadialGradient(
                    spot.x, spot.y, 0,
                    spot.x, spot.y, spot.radius
                );
                gradient.addColorStop(0, 'rgba(255, 0, 0, 0.6)');
                gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(spot.x, spot.y, spot.radius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        // Handle window resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Handle mouse movement
        function onMouseMove(event) {
            // Calculate mouse position in normalized device coordinates
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Check for object intersections
            checkIntersections();
            
            // Update compass direction based on camera rotation
            updateCompass();
        }

        // Check if mouse is over an interactive object
        function checkIntersections() {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects, true);
            
            // Reset cursor
            document.body.style.cursor = 'default';
            
            // No intersections
            if (intersects.length === 0) {
                if (currentIntersect) {
                    // Mouse exit from object
                    resetObjectGlow(currentIntersect);
                }
                currentIntersect = null;
                return;
            }
            
            // Get the first intersected object
            const firstIntersect = findParentInteractive(intersects[0].object);
            
            if (!firstIntersect) return;
            
            // Mouse enter new object
            if (currentIntersect !== firstIntersect) {
                if (currentIntersect) {
                    resetObjectGlow(currentIntersect);
                }
                setObjectGlow(firstIntersect);
                currentIntersect = firstIntersect;
            }
            
            // Change cursor to pointer
            document.body.style.cursor = 'pointer';
        }

        // Find the parent interactive object
        function findParentInteractive(object) {
            let current = object;
            while (current) {
                if (interactiveObjects.includes(current)) {
                    return current;
                }
                current = current.parent;
            }
            return null;
        }

        // Set glow effect on object
        function setObjectGlow(object) {
            if (!object) return;
            
            // Apply different effects based on object type
            if (object === tv) {
                const screen = object.children[0];
                screen.material.emissiveIntensity = 0.8;
            } else if (object === cityMap) {
                object.position.y += 0.05;
                object.material.emissive = new THREE.Color(0x64ffda);
                object.material.emissiveIntensity = 0.3;
            } else if (object === laptop) {
                const screen = object.children[1].children[0];
                screen.material.emissiveIntensity = 0.8;
            } else if (object === bookshelf) {
                for (let i = 1; i < object.children.length; i++) {
                    object.children[i].material.emissiveIntensity = 0.6;
                }
            }
        }

        // Reset glow effect on object
        function resetObjectGlow(object) {
            if (!object) return;
            
            if (object === tv) {
                const screen = object.children[0];
                screen.material.emissiveIntensity = 0.2;
            } else if (object === cityMap) {
                object.position.y -= 0.05;
                object.material.emissive = new THREE.Color(0x000000);
                object.material.emissiveIntensity = 0;
            } else if (object === laptop) {
                const screen = object.children[1].children[0];
                screen.material.emissiveIntensity = 0.3;
            } else if (object === bookshelf) {
                for (let i = 1; i < object.children.length; i++) {
                    object.children[i].material.emissiveIntensity = 0.2;
                }
            }
        }

        // Handle mouse clicks
        function onClick() {
            if (currentIntersect) {
                openProjectDetails(currentIntersect.name);
            }
        }

        // Handle keyboard input
        function onKeyDown(event) {
            const speed = 0.1;
            
            if (event.code === 'ArrowUp' || event.code === 'KeyW') {
                controls.target.z -= speed;
            } else if (event.code === 'ArrowDown' || event.code === 'KeyS') {
                controls.target.z += speed;
            } else if (event.code === 'ArrowLeft' || event.code === 'KeyA') {
                controls.target.x -= speed;
            } else if (event.code === 'ArrowRight' || event.code === 'KeyD') {
                controls.target.x += speed;
            } else if (event.code === 'Escape') {
                closeProjectDetails();
            }
        }

        // Update compass to reflect camera orientation
        function updateCompass() {
            const compassNeedle = document.getElementById('compass-needle');
            const cameraDirection = new THREE.Vector3();
            camera.getWorldDirection(cameraDirection);
            
            // Calculate angle in the XZ plane
            const angle = Math.atan2(cameraDirection.x, cameraDirection.z);
            compassNeedle.style.transform = `rotate(${angle}rad)`;
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Update controls
            controls.update();
            
            // Render scene
            renderer.render(scene, camera);
            
            // Update stopwatch
            updateStopwatch();
            
            // Update day/night cycle
            updateDayNightCycle();
        }

        // Update the room lighting based on visitor's local time
        function updateDayNightCycle() {
            const hour = new Date().getHours();
            
            // Map the hour to a value between 0 and 1
            // 0 = midnight (darkest), 0.5 = noon (brightest)
            const timeOfDay = ((hour % 24) / 24 + 0.5) % 1;
            
            // Calculate brightness (brightest at noon, darkest at midnight)
            const brightness = 0.5 + Math.sin(timeOfDay * Math.PI * 2) * 0.3;
            
            // Update ambient light
            scene.children.forEach(child => {
                if (child instanceof THREE.AmbientLight) {
                    child.intensity = brightness;
                }
            });
            
            // Color temperature (bluer at night, warmer in daytime)
            let lightColor;
            if (timeOfDay > 0.25 && timeOfDay < 0.75) {
                // Day time (warm)
                lightColor = new THREE.Color(0xffffff);
            } else {
                // Night time (cool)
                lightColor = new THREE.Color(0xb0c4de);
            }
            
            // Update directional light
            scene.children.forEach(child => {
                if (child instanceof THREE.DirectionalLight) {
                    child.color = lightColor;
                }
            });
        }

        // Display project details
        function openProjectDetails(objectName) {
            if (!objectName || !projectData[objectName]) return;
            
            const data = projectData[objectName];
            projectTitle.textContent = data.title;
            projectDescription.textContent = data.description;
            projectMedia.innerHTML = data.media;
            
            // Clear existing links
            projectLinks.innerHTML = '';
            
            // Add new links
            data.links.forEach(link => {
                const linkElement = document.createElement('a');
                linkElement.href = link.url;
                linkElement.className = 'project-link';
                linkElement.textContent = link.text;
                linkElement.target = '_blank';
                projectLinks.appendChild(linkElement);
            });
            
            // Show the details panel
            projectDetails.classList.add('active');
        }

        // Close project details
        function closeProjectDetails() {
            projectDetails.classList.remove('active');
        }

        // Toggle sound
        function toggleSound() {
            isSoundOn = !isSoundOn;
            
            if (isSoundOn) {
                ambientSound.play();
                soundToggle.innerHTML = '<span class="icon">🔊</span> Sound: On';
            } else {
                ambientSound.pause();
                soundToggle.innerHTML = '<span class="icon">🔇</span> Sound: Off';
            }
        }

        // Show help dialogue
        function showHelp() {
            alert('Navigation Controls:\n\n' +
                  '- Use mouse to look around\n' +
                  '- Arrow keys or WASD to move\n' +
                  '- Click on objects to interact\n' +
                  '- ESC to close details panels');
        }

        // Update stopwatch
        function updateStopwatch() {
            const now = new Date();
            const diff = now - targetDate;
            
            // Convert milliseconds to days, hours, minutes, seconds
            let days = Math.floor(diff / (1000 * 60 * 60 * 24));
            let hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            let seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            // Format with leading zeros
            days = days.toString().padStart(2, '0');
            hours = hours.toString().padStart(2, '0');
            minutes = minutes.toString().padStart(2, '0');
            seconds = seconds.toString().padStart(2, '0');
            
            // Update display
            const timeString = `${days}:${hours}:${minutes}:${seconds}`;
            stopwatchElement.textContent = timeString;
            if (mobileStopwatchElement) {
                mobileStopwatchElement.textContent = timeString;
            }
        }

        // Event Listeners
        enterButton.addEventListener('click', () => {
            introOverlay.style.opacity = 0;
            setTimeout(() => {
                introOverlay.style.display = 'none';
            }, 1500);
            
            // Start the experience
            init();
            
            // Try to play ambient sound (may be blocked by browser)
            if (isSoundOn) {
                ambientSound.play().catch(() => {
                    // Silently fail - sound will be available on user interaction
                });
            }
        });

        closeButton.addEventListener('click', closeProjectDetails);
        soundToggle.addEventListener('click', toggleSound);
        helpButton.addEventListener('click', showHelp);

        // Mobile event handlers
        tvProject.addEventListener('click', () => openProjectDetails('tv'));
        mapProject.addEventListener('click', () => openProjectDetails('map'));
        laptopProject.addEventListener('click', () => openProjectDetails('laptop'));

        // Start updating the stopwatch immediately
        setInterval(updateStopwatch, 1000);
        updateStopwatch();

        // Check if mobile view should be active
        function checkMobileView() {
            if (window.innerWidth <= 768) {
                loadingIndicator.style.display = 'none';
                introOverlay.style.display = 'none';
                updateStopwatch();
            }
        }

        // Call on first load
        checkMobileView();
        window.addEventListener('resize', checkMobileView);
    </script>
<!-- Add this block to embed the like button -->
    <script src="/static/js/like_button.js"></script>
    <script>
        LikeButton.init({
          pageId: "20250402",
          position: "bottom-right", // Options: bottom-right, bottom-left, top-right, top-left
        });
    </script>

</body>
</html>