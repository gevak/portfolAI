<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FATAL ERROR - Geva Kipper</title>
    <style>
        /* Base styles */
        :root {
            --bg-light: #f9f9f9;
            --bg-dark: #1e1e1e;
            --text-light: #333;
            --text-dark: #e0e0e0;
            --error: #ff5555;
            --warning: #ffb86c;
            --success: #50fa7b;
            --info: #8be9fd;
            --comment: #6272a4;
            --primary: #bd93f9;
            --secondary: #ff79c6;
            --terminal-bg-light: #f0f0f0;
            --terminal-bg-dark: #282a36;
            --cursor-color: var(--secondary);
        }

        [data-theme="light"] {
            --bg: var(--bg-light);
            --text: var(--text-light);
            --terminal-bg: var(--terminal-bg-light);
        }

        [data-theme="dark"] {
            --bg: var(--bg-dark);
            --text: var(--text-dark);
            --terminal-bg: var(--terminal-bg-dark);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Fira Code', 'Courier New', monospace;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Fatal Error Screen */
        .crash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--bg);
            color: var(--error);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 2rem;
            overflow-y: auto;
        }

        .crash-screen h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: bold;
        }

        .stack-trace {
            color: var(--text);
            font-size: 0.9rem;
            white-space: pre-wrap;
            line-height: 1.4;
            margin: 1rem 0;
            padding: 1rem;
            background-color: var(--terminal-bg);
            border-radius: 4px;
            max-width: 800px;
        }

        .tooltip {
            color: var(--comment);
            font-size: 0.9rem;
            margin-top: 2rem;
            opacity: 0;
            animation: fadeInOut 5s infinite 2s;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        /* Header Section */
        header {
            display: none;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .blinking-cursor {
            display: inline-block;
            width: 12px;
            height: 24px;
            background-color: var(--cursor-color);
            margin-left: 4px;
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .typing-text {
            display: inline-block;
            white-space: nowrap;
            overflow: hidden;
            border-right: 3px solid transparent;
        }

        .subtitle {
            color: var(--comment);
            font-size: 1rem;
            margin: 1rem 0;
        }

        .mini-terminal {
            background-color: var(--terminal-bg);
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            position: relative;
        }

        .terminal-title {
            position: absolute;
            top: -10px;
            left: 10px;
            background-color: var(--bg);
            padding: 0 8px;
            font-size: 0.8rem;
            color: var(--comment);
        }

        /* Navigation and Projects */
        .projects-container {
            display: none;
            flex-direction: column;
            gap: 2rem;
        }

        .project-box {
            display: none;
            background-color: var(--terminal-bg);
            border-radius: 6px;
            padding: 1.5rem;
            position: relative;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(20px);
            animation-fill-mode: forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .project-box h3 {
            color: var(--comment);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .project-description {
            margin-bottom: 1rem;
            font-size: 1rem;
            line-height: 1.6;
        }

        .project-link {
            color: var(--info);
            text-decoration: none;
            font-size: 0.9rem;
            display: block;
            margin: 0.5rem 0;
        }

        .project-link:hover {
            text-decoration: underline;
        }

        .project-console {
            background-color: rgba(0, 0, 0, 0.1);
            padding: 0.8rem;
            margin-top: 1rem;
            border-radius: 4px;
            font-size: 0.85rem;
            display: none;
        }

        .project-challenge {
            margin-top: 1rem;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.07);
            border-radius: 4px;
        }

        /* Challenge specific styles */
        .regex-challenge input {
            width: 100%;
            padding: 0.5rem;
            margin: 0.5rem 0;
            font-family: inherit;
            background-color: var(--bg);
            color: var(--text);
            border: 1px solid var(--comment);
            border-radius: 3px;
        }

        .shape {
            width: 60px;
            height: 60px;
            position: absolute;
            cursor: move;
            user-select: none;
            transition: transform 0.2s;
        }

        .shape-container {
            position: relative;
            height: 200px;
            border: 1px dashed var(--comment);
            margin: 1rem 0;
        }

        .target-zone {
            position: absolute;
            border: 2px dashed var(--comment);
            opacity: 0.5;
        }

        /* Bottom Section */
        footer {
            display: none;
            margin-top: auto;
            padding-top: 2rem;
            font-size: 0.9rem;
            color: var(--comment);
        }

        .stopwatch {
            font-size: 1rem;
            margin: 1rem 0;
            color: var(--secondary);
        }

        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 26px;
            border-radius: 13px;
            background-color: var(--terminal-bg);
            cursor: pointer;
            display: none;
            align-items: center;
            padding: 3px;
            z-index: 100;
        }

        .toggle-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--primary);
            transition: transform 0.3s;
        }

        .theme-toggle[data-theme="dark"] .toggle-thumb {
            transform: translateX(24px);
        }

        /* Easter egg */
        .command-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--terminal-bg);
            border-radius: 8px;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            z-index: 2000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: none;
        }

        .command-overlay h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .command-list {
            list-style: none;
        }

        .command-list li {
            margin-bottom: 0.5rem;
            display: flex;
        }

        .command-name {
            color: var(--secondary);
            width: 120px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .stack-trace {
                font-size: 0.8rem;
            }
            
            h1 {
                font-size: 2rem;
            }

            .tooltip {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Fatal Error Screen -->
    <div class="crash-screen" id="crashScreen">
        <h1>FATAL ERROR</h1>
        <div class="stack-trace">
Uncaught TypeError: Cannot read properties of undefined (reading 'portfolio')
    at Portfolio.initialize (portfolio.js:42)
    at new Portfolio (portfolio.js:15)
    at loadPortfolio (main.js:24)
    at window.onload (index.html:186)

Details:
  - this._projects[3].portfolio is undefined
  - Expected object structure not found
  - DOM initialization failed
  - Missing dependencies: debug.js

Stack trace shows internal implementation errors.
Try checking browser console for more information.
        </div>
        <p class="tooltip">Hint: Debug to continue. Open your browser developer tools (F12 or Ctrl+Shift+I).</p>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle" id="themeToggle" data-theme="light">
        <div class="toggle-thumb"></div>
    </div>

    <!-- Header Section -->
    <header id="header">
        <h1>Geva Kipper<span class="blinking-cursor"></span></h1>
        <p class="typing-text" id="typingText">AI Engineer @ Google Research</p>
        <p class="subtitle">Portfolio redesigned with AI assistance // Last updated: <span id="timestamp">2025-04-10 02:39:15</span></p>
        <div class="mini-terminal">
            <span class="terminal-title">console</span>
            <div id="fixedBugMessage">
                <span style="color: var(--success);">[Fixed]</span> Portfolio object initialized correctly.
                <br>
                <span style="color: var(--comment);">> _projects loaded: 5</span>
                <br>
                <span style="color: var(--comment);">> Welcome! Solve challenges to explore projects.</span>
            </div>
        </div>
    </header>

    <!-- Projects Container -->
    <main class="projects-container" id="projectsContainer">
        <!-- GlglStats Project -->
        <div class="project-box" id="project1">
            <h3>/* GlglStats Audio Analysis */</h3>
            <div class="project-description">
                /**
                 * Web application for analyzing audio timestamps and statistics
                 * from podcasts and interviews. Uses machine learning to detect 
                 * speech patterns and highlight insights.
                 * 
                 * @tech JavaScript, Python, WebAudio API, TensorFlow
                 */
            </div>
            <a href="https://glglstats.onrender.com/" class="project-link">visit("https://glglstats.onrender.com/");</a>
            <a href="https://www.youtube.com/watch?v=jrKAtOsj1Lo" class="project-link">watchPresentation("YouTube Conference Video");</a>
            <div class="project-console" id="console1">
                <span style="color: var(--success);">Section unlocked successfully! Regex debugged.</span>
            </div>
            <div class="project-challenge" id="challenge1">
                <h4>Debug the RegEx pattern to unlock details:</h4>
                <p>Fix the regular expression to match timestamps in format HH:MM:SS</p>
                <code>const timePattern = /</code>
                <input type="text" id="regexInput" placeholder="Enter regex pattern here">
                <code>/;</code>
                <p>Test string: "12:34:56 starts at 01:23:45 and ends at 02:34:56"</p>
                <button id="testRegex">Test Pattern</button>
            </div>
        </div>

        <!-- Ahuzat Dibuk Project -->
        <div class="project-box" id="project2">
            <h3>/* Ahuzat Dibuk - Housing Data */</h3>
            <div class="project-description">
                /**
                 * Crowdsourced platform gathering and analyzing apartment 
                 * rental and purchase data across Tel Aviv. Featured in 
                 * major news outlets for exposing market inconsistencies.
                 * 
                 * @tech Node.js, MongoDB, Data Visualization, Web Scraping
                 */
            </div>
            <a href="https://www.facebook.com/groups/secrettelaviv/posts/10159636301195943" class="project-link">viewPublication("Facebook Publication");</a>
            <a href="https://13tv.co.il/item/news/domestic/internal/parking-902956407/" class="project-link">viewMedia("Channel 13 Coverage");</a>
            <a href="https://www.mako.co.il/nexter-news/Article-ae43964b891bf71027.htm" class="project-link">viewMedia("Mako News Article");</a>
            <div class="project-console" id="console2">
                <span style="color: var(--success);">Section unlocked! Web scraper function completed.</span>
            </div>
            <div class="project-challenge" id="challenge2">
                <h4>Complete the data scraping function:</h4>
                <pre style="margin: 1rem 0; line-height: 1.4;">
function scrapePriceData(htmlContent) {
  const results = [];
  
  // Complete this function to extract price data
  const priceElements = htmlContent.querySelectorAll(<span id="selectorInput" contenteditable="true" style="border-bottom: 1px solid var(--comment); min-width: 100px; display: inline-block;">.price-element</span>);
  
  priceElements.forEach(element => {
    const price = element.innerText.match(<span id="pricePattern" contenteditable="true" style="border-bottom: 1px solid var(--comment); min-width: 100px; display: inline-block;">/\d+/</span>);
    if(price) {
      results.push(parseInt(price[0]));
    }
  });
  
  return results;
}</pre>
                <button id="testScraper">Test Function</button>
            </div>
        </div>

        <!-- 2D Part Orienting Project -->
        <div class="project-box" id="project3">
            <h3>/* 2D Part Orienting Research */</h3>
            <div class="project-description">
                /**
                 * Research project at Tel Aviv University focused on developing
                 * algorithms for optimal orientation of mechanical parts using
                 * computational geometry and physical simulation.
                 * 
                 * @tech C++, Computational Geometry, Physics Simulation, MATLAB
                 */
            </div>
            <a href="https://www.cgl.cs.tau.ac.il/projects/2d-part-orienting/" class="project-link">viewResearch("Tel Aviv University Project Page");</a>
            <div class="project-console" id="console3">
                <span style="color: var(--success);">Section unlocked! Parts successfully oriented.</span>
            </div>
            <div class="project-challenge" id="challenge3">
                <h4>Orient the geometric shapes correctly:</h4>
                <p>Drag each shape to its matching target zone.</p>
                <div class="shape-container" id="shapeContainer">
                    <div class="shape" id="triangle" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%); background-color: #ff5555; top: 20px; left: 20px;"></div>
                    <div class="shape" id="square" style="background-color: #50fa7b; top: 100px; left: 20px;"></div>
                    <div class="shape" id="circle" style="border-radius: 50%; background-color: #8be9fd; top: 20px; left: 100px;"></div>
                    
                    <div class="target-zone" id="triangleTarget" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%); width: 65px; height: 65px; top: 20px; right: 20px;"></div>
                    <div class="target-zone" id="squareTarget" style="width: 65px; height: 65px; top: 100px; right: 20px;"></div>
                    <div class="target-zone" id="circleTarget" style="border-radius: 50%; width: 65px; height: 65px; top: 20px; right: 100px;"></div>
                </div>
            </div>
        </div>

        <!-- Portfolio Project -->
        <div class="project-box" id="project4">
            <h3>/* Self-Debugging Portfolio */</h3>
            <div class="project-description">
                /**
                 * Meta-interactive portfolio website designed to showcase both
                 * technical projects and problem-solving abilities through
                 * debugging challenges and interactive elements.
                 * 
                 * @tech HTML5, CSS3, JavaScript, Interactive Design
                 */
            </div>
            <a href="https://portfolio-dor1.onrender.com/" class="project-link">viewCurrentSite("Portfolio Mirror");</a>
            <div class="project-console" id="console4">
                <span style="color: var(--success);">Section unlocked! Recursive reference fixed.</span>
            </div>
            <div class="project-challenge" id="challenge4">
                <h4>Fix the recursive reference bug:</h4>
                <pre style="margin: 1rem 0; line-height: 1.4;">
// Portfolio class constructor has an infinite loop
function Portfolio(projects) {
  this.projects = projects;
  
  // The bug is somewhere in this method
  this.getProjectById = function(id) {
    <span id="recursiveCode" contenteditable="true" style="border-bottom: 1px solid var(--comment); min-width: 300px; display: inline-block;">return this.getProjectById(id);</span>
  }
}</pre>
                <button id="testRecursive">Test Fix</button>
            </div>
        </div>

        <!-- Social Links Project -->
        <div class="project-box" id="project5">
            <h3>/* Connect With Me */</h3>
            <div class="project-description">
                /**
                 * Professional networking and social media profiles. 
                 * Connect for collaboration opportunities or to discuss
                 * projects and research interests.
                 * 
                 * @links GitHub, LinkedIn, Facebook
                 */
            </div>
            <div id="socialLinks" style="display: none;">
                <a href="https://github.com/gevak" class="project-link">connectGitHub("github.com/gevak");</a>
                <a href="https://linkedin.com/in/gevakip" class="project-link">connectLinkedIn("linkedin.com/in/gevakip");</a>
                <a href="https://facebook.com/geva.kipper" class="project-link">connectFacebook("facebook.com/geva.kipper");</a>
            </div>
            <div class="project-console" id="console5">
                <span style="color: var(--success);">Social links decrypted successfully!</span>
            </div>
            <div class="project-challenge" id="challenge5">
                <h4>Decrypt the social links:</h4>
                <p>Each character is shifted by a certain number. Find the pattern to decode.</p>
                <pre style="margin: 1rem 0; line-height: 1.4;">
Encrypted data:
hjuivc.dpn/hfwbl
mjolfejo.dpn/jo/hfwbljq
gbdfcppl.dpn/hfwb.ljqqfs</pre>
                <p>Enter the decryption shift (hint: try numbers 1-5):</p>
                <input type="number" id="decryptShift" min="1" max="5" value="1">
                <button id="testDecryption">Decrypt</button>
            </div>
        </div>
    </main>

    <!-- Footer Section -->
    <footer id="footer">
        <p>Designed by GPT-4 // <span id="currentTime"></span></p>
        <div class="stopwatch">
            <span id="stopwatch">00:00:00:000</span> since last update
        </div>
    </footer>

    <!-- Command Overlay (Easter Egg) -->
    <div class="command-overlay" id="commandOverlay">
        <h3>Available Commands</h3>
        <ul class="command-list">
            <li><span class="command-name">help</span> <span>Show this command list</span></li>
            <li><span class="command-name">theme</span> <span>Toggle light/dark mode</span></li>
            <li><span class="command-name">unlock</span> <span>Skip all debugging challenges</span></li>
            <li><span class="command-name">reset</span> <span>Reset website to initial state</span></li>
            <li><span class="command-name">contact</span> <span>Show direct contact information</span></li>
        </ul>
        <p style="margin-top: 1rem; text-align: right;">
            <button id="closeCommands">Close</button>
        </p>
    </div>

    <script>
        // Initial setup - detect preferred color scheme
        const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.body.dataset.theme = prefersDarkMode ? 'dark' : 'light';
        
        // Debug mode, intentionally global for console access
        let debugMode = false;
        let projectsUnlocked = [false, false, false, false, false];
        
        // Initialize the time elements
        const lastUpdateTime = new Date('2025-04-10T02:39:15');
        const timestampElement = document.getElementById('timestamp');
        const stopwatchElement = document.getElementById('stopwatch');
        const currentTimeElement = document.getElementById('currentTime');
        
        // Wait for the console message
        console.error("Portfolio initialization failed. Try calling debug.init() to fix the error.");
        
        // The 'debug' object that users need to create
        window.debug = {
            init: function() {
                console.log("%cDebugging initialized", "color: #50fa7b");
                console.log("Setting up debugging environment...");
                setTimeout(() => {
                    console.log("%cFound issue: _projects[3].portfolio is undefined", "color: #ffb86c");
                    console.log("Run debug.fix() to apply the patch");
                }, 1000);
                debugMode = true;
                return this;
            },
            
            fix: function() {
                if (!debugMode) {
                    console.error("Please run debug.init() first");
                    return;
                }
                console.log("%cApplying fix...", "color: #8be9fd");
                setTimeout(() => {
                    console.log("%cFix applied successfully!", "color: #50fa7b");
                    document.getElementById('crashScreen').style.display = 'none';
                    document.getElementById('header').style.display = 'block';
                    document.getElementById('projectsContainer').style.display = 'flex';
                    document.getElementById('footer').style.display = 'block';
                    document.getElementById('themeToggle').style.display = 'flex';
                    document.title = "Geva Kipper - Portfolio";
                    startTypingAnimation();
                    revealProject(0);
                }, 1500);
                return this;
            },
            
            // Additional debugging utility methods
            inspect: function(projectId) {
                console.log(`Inspecting project ${projectId}`);
                console.log(projectsUnlocked);
                return "Use debug.unlock(projectId) to unlock a specific project";
            },
            
            unlock: function(projectId) {
                if (projectId >= 0 && projectId < 5) {
                    revealProject(projectId);
                    return `Project ${projectId + 1} unlocked`;
                }
                return "Invalid project ID";
            },
            
            unlockAll: function() {
                for (let i = 0; i < 5; i++) {
                    revealProject(i);
                }
                return "All projects unlocked";
            },
            
            reset: function() {
                location.reload();
                return "Resetting...";
            }
        };
        
        // Typing animation for the header
        function startTypingAnimation() {
            const text = "AI Engineer @ Google Research";
            const typingElement = document.getElementById('typingText');
            typingElement.textContent = "";
            let i = 0;
            
            function typeCharacter() {
                if (i < text.length) {
                    typingElement.textContent += text.charAt(i);
                    i++;
                    setTimeout(typeCharacter, 50 + Math.random() * 50);
                }
            }
            
            typeCharacter();
        }
        
        // Reveal project section
        function revealProject(index) {
            if (projectsUnlocked[index]) return;
            
            const projectElement = document.getElementById(`project${index + 1}`);
            projectElement.style.display = 'block';
            projectElement.style.animation = 'fadeInUp 0.6s ease forwards';
            
            projectsUnlocked[index] = true;
        }
        
        // Complete project challenge
        function completeChallenge(index) {
            const challengeElement = document.getElementById(`challenge${index + 1}`);
            const consoleElement = document.getElementById(`console${index + 1}`);
            
            challengeElement.style.display = 'none';
            consoleElement.style.display = 'block';
            
            // Special handling for social links project
            if (index === 4) {
                document.getElementById('socialLinks').style.display = 'block';
            }
        }
        
        // Update the stopwatch
        function updateStopwatch() {
            const now = new Date();
            const diff = now - lastUpdateTime;
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            const milliseconds = diff % 1000;
            
            const formattedDays = days.toString().padStart(2, '0');
            const formattedHours = hours.toString().padStart(2, '0');
            const formattedMinutes = minutes.toString().padStart(2, '0');
            const formattedSeconds = seconds.toString().padStart(2, '0');
            const formattedMilliseconds = milliseconds.toString().padStart(3, '0');
            
            if (days > 0) {
                stopwatchElement.textContent = `${formattedDays}d ${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
            } else {
                stopwatchElement.textContent = `${formattedHours}:${formattedMinutes}:${formattedSeconds}:${formattedMilliseconds}`;
            }
            
            currentTimeElement.textContent = now.toLocaleTimeString();
            
            requestAnimationFrame(updateStopwatch);
        }
        
        // Theme toggling
        document.getElementById('themeToggle').addEventListener('click', function() {
            const currentTheme = document.body.dataset.theme;
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.dataset.theme = newTheme;
            this.dataset.theme = newTheme;
        });
        
        // Challenge 1: RegEx Test
        document.getElementById('testRegex').addEventListener('click', function() {
            const regexInput = document.getElementById('regexInput').value.trim();
            
            if (regexInput) {
                try {
                    const regex = new RegExp(regexInput, 'g');
                    const testString = "12:34:56 starts at 01:23:45 and ends at 02:34:56";
                    const matches = testString.match(regex);
                    
                    // Check if the regex correctly matches all three timestamps
                    if (matches && matches.length === 3 && 
                        matches.includes("12:34:56") && 
                        matches.includes("01:23:45") && 
                        matches.includes("02:34:56")) {
                        completeChallenge(0);
                    } else {
                        alert("Not quite right. The pattern should match exactly the three timestamps in the format HH:MM:SS");
                    }
                } catch (e) {
                    alert("Invalid regular expression: " + e.message);
                }
            } else {
                alert("Please enter a regular expression");
            }
        });
        
        // Challenge 2: Scraper Test
        document.getElementById('testScraper').addEventListener('click', function() {
            const selector = document.getElementById('selectorInput').textContent.trim();
            const pricePattern = document.getElementById('pricePattern').textContent.trim();
            
            // Check if both fields are filled
            if (selector && pricePattern) {
                // Simple validation of the selector (looking for a CSS selector like ".price-element")
                const selectorValid = /^\.[a-z-]+$/.test(selector);
                
                // Simple validation of the price pattern (looking for regex to extract numbers)
                let pricePatternValid = false;
                try {
                    const regex = eval(pricePattern);
                    pricePatternValid = regex instanceof RegExp && "₪4,500".match(regex);
                } catch (e) {
                    pricePatternValid = false;
                }
                
                if (selectorValid && pricePatternValid) {
                    completeChallenge(1);
                } else {
                    if (!selectorValid) {
                        alert("The selector doesn't look right. Try something like '.price-element'");
                    } else {
                        alert("The price pattern doesn't seem to match price formats. Try a pattern that would match '₪4,500'");
                    }
                }
            } else {
                alert("Please fill in both the selector and price pattern");
            }
        });
        
        // Challenge 3: Shape Orientation
        const shapes = ['triangle', 'square', 'circle'];
        let shapesInPlace = 0;
        
        shapes.forEach(shapeId => {
            const shape = document.getElementById(shapeId);
            const target = document.getElementById(shapeId + 'Target');
            
            // Make the shape draggable
            let isDragging = false;
            let offsetX, offsetY;
            
            shape.addEventListener('mousedown', startDrag);
            shape.addEventListener('touchstart', startDragTouch);
            
            function startDrag(e) {
                isDragging = true;
                offsetX = e.clientX - shape.getBoundingClientRect().left;
                offsetY = e.clientY - shape.getBoundingClientRect().top;
                document.addEventListener('mousemove', dragMove);
                document.addEventListener('mouseup', stopDrag);
            }
            
            function startDragTouch(e) {
                isDragging = true;
                const touch = e.touches[0];
                offsetX = touch.clientX - shape.getBoundingClientRect().left;
                offsetY = touch.clientY - shape.getBoundingClientRect().top;
                document.addEventListener('touchmove', dragMoveTouch);
                document.addEventListener('touchend', stopDragTouch);
                e.preventDefault();
            }
            
            function dragMove(e) {
                if (!isDragging) return;
                const container = document.getElementById('shapeContainer');
                const containerRect = container.getBoundingClientRect();
                
                let left = e.clientX - offsetX - containerRect.left;
                let top = e.clientY - offsetY - containerRect.top;
                
                // Keep within container bounds
                left = Math.max(0, Math.min(left, containerRect.width - shape.offsetWidth));
                top = Math.max(0, Math.min(top, containerRect.height - shape.offsetHeight));
                
                shape.style.left = left + 'px';
                shape.style.top = top + 'px';
                
                checkOverlap();
            }
            
            function dragMoveTouch(e) {
                if (!isDragging) return;
                const touch = e.touches[0];
                const container = document.getElementById('shapeContainer');
                const containerRect = container.getBoundingClientRect();
                
                let left = touch.clientX - offsetX - containerRect.left;
                let top = touch.clientY - offsetY - containerRect.top;
                
                // Keep within container bounds
                left = Math.max(0, Math.min(left, containerRect.width - shape.offsetWidth));
                top = Math.max(0, Math.min(top, containerRect.height - shape.offsetHeight));
                
                shape.style.left = left + 'px';
                shape.style.top = top + 'px';
                
                checkOverlap();
                e.preventDefault();
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', dragMove);
                document.removeEventListener('mouseup', stopDrag);
                checkOverlap();
            }
            
            function stopDragTouch() {
                isDragging = false;
                document.removeEventListener('touchmove', dragMoveTouch);
                document.removeEventListener('touchend', stopDragTouch);
                checkOverlap();
            }
            
            function checkOverlap() {
                const shapeRect = shape.getBoundingClientRect();
                const targetRect = target.getBoundingClientRect();
                
                // Check if more than 75% of the shape overlaps with target
                const overlapX = Math.max(0, Math.min(shapeRect.right, targetRect.right) - Math.max(shapeRect.left, targetRect.left));
                const overlapY = Math.max(0, Math.min(shapeRect.bottom, targetRect.bottom) - Math.max(shapeRect.top, targetRect.top));
                
                const overlapArea = overlapX * overlapY;
                const shapeArea = shapeRect.width * shapeRect.height;
                
                if (overlapArea > 0.75 * shapeArea) {
                    shape.style.left = (target.offsetLeft + (target.offsetWidth - shape.offsetWidth) / 2) + 'px';
                    shape.style.top = (target.offsetTop + (target.offsetHeight - shape.offsetHeight) / 2) + 'px';
                    shape.style.cursor = 'default';
                    shape.removeEventListener('mousedown', startDrag);
                    shape.removeEventListener('touchstart', startDragTouch);
                    
                    shapesInPlace++;
                    if (shapesInPlace === 3) {
                        completeChallenge(2);
                    }
                }
            }
        });
        
        // Challenge 4: Fix Recursive Reference
        document.getElementById('testRecursive').addEventListener('click', function() {
            const fixedCode = document.getElementById('recursiveCode').textContent.trim();
            
            // Check if the fix is valid - looking for any variation that avoids the recursion
            const noRecursion = !fixedCode.includes('getProjectById');
            const usesProjects = fixedCode.includes('projects') || fixedCode.includes('this.projects');
            const returnsProject = fixedCode.includes('return') && (fixedCode.includes('id') || fixedCode.includes('projects'));
            
            if (noRecursion && usesProjects && returnsProject) {
                completeChallenge(3);
            } else {
                alert("Not quite right. The fix should avoid calling the same function recursively and return the correct project.");
            }
        });
        
        // Challenge 5: Decrypt Shift Cipher
        document.getElementById('testDecryption').addEventListener('click', function() {
            const shift = parseInt(document.getElementById('decryptShift').value);
            
            if (shift === 1) { // Correct answer
                completeChallenge(4);
            } else {
                const encrypted = [
                    "hjuivc.dpn/hfwbl", 
                    "mjolfejo.dpn/jo/hfwbljq", 
                    "gbdfcppl.dpn/hfwb.ljqqfs"
                ];
                
                let decrypted = encrypted.map(str => {
                    return str.split('').map(char => {
                        // Apply the shift to each character
                        if (char.match(/[a-z]/i)) {
                            const code = char.charCodeAt(0);
                            // For lowercase letters
                            if (code >= 97 && code <= 122) {
                                return String.fromCharCode(((code - 97 - shift + 26) % 26) + 97);
                            }
                            // For uppercase letters
                            else if (code >= 65 && code <= 90) {
                                return String.fromCharCode(((code - 65 - shift + 26) % 26) + 65);
                            }
                        }
                        return char;
                    }).join('');
                });
                
                alert("Not the correct shift. With shift " + shift + ", the result is:\n" + decrypted.join("\n"));
            }
        });
        
        // Easter egg - detect "help" command
        window.addEventListener('keydown', function(e) {
            const pressedKey = e.key.toLowerCase();
            
            // Track the last 4 keys pressed
            if (!window.keyBuffer) window.keyBuffer = [];
            window.keyBuffer.push(pressedKey);
            if (window.keyBuffer.length > 4) window.keyBuffer.shift();
            
            // Check if the last 4 keys spell "help"
            if (window.keyBuffer.join('').endsWith('help')) {
                document.getElementById('commandOverlay').style.display = 'block';
            }
        });
        
        // Close command overlay
        document.getElementById('closeCommands').addEventListener('click', function() {
            document.getElementById('commandOverlay').style.display = 'none';
        });
        
        // Command listener
        window.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.getElementById('commandOverlay').style.display = 'none';
            }
            
            // Listen for command execution
            if (e.key === 'Enter' && document.activeElement === document.body) {
                const command = prompt("Enter a command (try 'help'):");
                if (command) {
                    executeCommand(command.toLowerCase());
                }
            }
        });
        
        // Execute command typed by user
        function executeCommand(command) {
            switch(command) {
                case 'help':
                    document.getElementById('commandOverlay').style.display = 'block';
                    break;
                case 'theme':
                    const currentTheme = document.body.dataset.theme;
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    document.body.dataset.theme = newTheme;
                    document.getElementById('themeToggle').dataset.theme = newTheme;
                    break;
                case 'unlock':
                    debug.unlockAll();
                    break;
                case 'reset':
                    location.reload();
                    break;
                case 'contact':
                    alert("Contact: geva.kipper@example.com\nPhone: +972 1234567");
                    break;
                default:
                    alert("Unknown command: " + command + "\nType 'help' for available commands");
            }
        }
        
        // Start the stopwatch
        updateStopwatch();
        
        // Mobile shake detection to reveal hint
        if (window.DeviceMotionEvent) {
            let shakeThreshold = 15;
            let lastX = null, lastY = null, lastZ = null;
            let moveCounter = 0;
            
            window.addEventListener('devicemotion', function(e) {
                let acceleration = e.accelerationIncludingGravity;
                
                if (lastX === null && lastY === null && lastZ === null) {
                    lastX = acceleration.x;
                    lastY = acceleration.y;
                    lastZ = acceleration.z;
                    return;
                }
                
                let deltaX = Math.abs(lastX - acceleration.x);
                let deltaY = Math.abs(lastY - acceleration.y);
                let deltaZ = Math.abs(lastZ - acceleration.z);
                
                if ((deltaX > shakeThreshold && deltaY > shakeThreshold) || 
                    (deltaX > shakeThreshold && deltaZ > shakeThreshold) || 
                    (deltaY > shakeThreshold && deltaZ > shakeThreshold)) {
                        
                    moveCounter++;
                    
                    if (moveCounter > 3 && !debugMode) {
                        alert("Hint: Try typing 'debug.init()' in the console (F12)");
                        moveCounter = 0;
                    }
                }
                
                lastX = acceleration.x;
                lastY = acceleration.y;
                lastZ = acceleration.z;
            }, false);
        }
    </script>
<!-- Add this block to embed the like button -->
    <script src="/static/js/like_button.js"></script>
    <script>
        LikeButton.init({
          pageId: "20250410",
          position: "bottom-right", // Options: bottom-right, bottom-left, top-right, top-left
        });
    </script>

</body>
</html>