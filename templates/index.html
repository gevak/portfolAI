<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geva Kipper | Cyberpunk Architect</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=share+tech+mono&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #050a10;
            --glass-bg: rgba(12, 20, 35, 0.7);
            --glass-border: rgba(100, 255, 218, 0.2);
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-green: #0aff00;
            --text-color: #e2e8f0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Share Tech Mono', monospace;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        /* --- 3D Canvas --- */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* --- Header --- */
        .glass-panel {
            position: absolute;
            top: 40px;
            left: 40px;
            width: 380px;
            padding: 25px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-left: 4px solid var(--neon-blue);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            z-index: 10;
            transform: perspective(1000px) rotateY(10deg) rotateX(5deg);
            transition: transform 0.3s ease;
        }

        .glass-panel:hover {
            transform: perspective(1000px) rotateY(0deg) rotateX(0deg);
            border-color: var(--neon-blue);
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
            margin-bottom: 5px;
        }

        h2 {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        #ai-disclaimer {
            font-size: 0.8rem;
            color: var(--neon-green);
            min-height: 40px;
            line-height: 1.4;
        }

        .caret {
            display: inline-block;
            width: 8px;
            height: 15px;
            background: var(--neon-green);
            animation: blink 1s infinite;
        }

        /* --- Footer --- */
        .system-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: #020408;
            border-top: 1px solid #1e293b;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 0.8rem;
            color: #64748b;
        }

        .footer-left span { color: var(--neon-purple); }
        .footer-right { font-family: 'Orbitron', monospace; letter-spacing: 1px; color: var(--neon-blue); }

        /* --- Modals --- */
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            width: 600px;
            max-width: 90%;
            background: #0f172a;
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
            padding: 30px;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--neon-purple);
            cursor: pointer;
        }

        .modal-title {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-blue);
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-left: 5px solid var(--neon-green);
            padding-left: 15px;
        }

        .modal-body {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .modal-body a {
            color: var(--neon-green);
            text-decoration: none;
            border-bottom: 1px dotted var(--neon-green);
            transition: 0.2s;
        }
        
        .modal-body a:hover {
            background: rgba(10, 255, 0, 0.1);
        }

        .video-container {
            margin-top: 15px;
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            border: 1px solid #333;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            text-decoration: none;
            font-family: 'Orbitron';
            font-size: 0.8rem;
            transition: 0.3s;
            cursor: pointer;
            margin-right: 10px;
        }

        .btn:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 15px var(--neon-blue);
        }

        /* Tooltip Helper */
        #cursor-tooltip {
            position: absolute;
            pointer-events: none;
            background: rgba(0,0,0,0.8);
            padding: 5px 10px;
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            font-size: 0.7rem;
            z-index: 50;
            opacity: 0;
            transform: translate(15px, 15px);
            transition: opacity 0.2s;
        }

        /* Glitch Animation */
        .glitch {
            animation: glitch-anim 2.5s infinite;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes glitch-anim {
            0% { transform: translate(0); }
            2% { transform: translate(-2px, 1px); }
            4% { transform: translate(2px, -1px); }
            6% { transform: translate(0); }
            100% { transform: translate(0); }
        }
    </style>
</head>
<body>

    <!-- 3D Scene Container -->
    <div id="canvas-container"></div>
    
    <!-- Custom Cursor Tooltip -->
    <div id="cursor-tooltip">INTERACT</div>

    <!-- Header -->
    <header class="glass-panel">
        <h1>Geva Kipper</h1>
        <h2>Software Engineer @ Google</h2>
        <div id="ai-disclaimer">
            <span id="typewriter-text"></span><span class="caret"></span>
        </div>
    </header>

    <!-- Footer -->
    <footer class="system-footer">
        <div class="footer-left">
            > SOURCE: <span class="glitch">AI_ARCHITECT</span> // SESSION ID: <span id="session-id"></span>
        </div>
        <div class="footer-right">
            T-MINUS: <span id="epoch-timer">00:00:00:000</span>
        </div>
    </footer>

    <!-- Modals (Hidden by default) -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-close">Ã—</div>
            <div id="modal-inner">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- Dependencies -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
                "gsap": "https://unpkg.com/gsap@3.12.5/index.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';
        
        // --- 1. CORE VARIABLES ---
        
        let scene, camera, renderer, raycaster, mouse;
        let interactiveObjects = [];
        let hoveredObject = null;
        let clock = new THREE.Clock();
        
        // Asset groups
        let roomGroup, turntable, wallMap, robotArm, arcade, typewriter, monitor, shelfItems;
        let spotlight; // Mouse follower

        const colors = {
            dark: 0x1e293b,
            floor: 0x0f172a,
            neonBlue: 0x00f3ff,
            neonPurple: 0xbc13fe,
            neonGreen: 0x0aff00,
            neonYellow: 0xffea00
        };

        const projectData = {
            'turntable': {
                title: 'GlglStats',
                html: `
                    <p>Analysis of Galgalatz radio station data using LZ77 compression visualization.</p>
                    <p class="modal-body"><a href="https://glglstats.geekip.dev" target="_blank">Visit Project</a></p>
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/jrKAtOsj1Lo" frameborder="0" allowfullscreen></iframe>
                    </div>
                `
            },
            'wallMap': {
                title: 'Ahuzat Dibuk',
                html: `
                    <p>Scraping Tel Aviv parking lots to visualize congestion heatmaps.</p>
                    <p><strong>Methodology:</strong> Python scrapers, Facebook Graph API.</p>
                    <div style="margin-top:15px">
                        <a href="https://www.facebook.com/groups/secrettelaviv/posts/10159636301195943" target="_blank" class="btn">Facebook Post</a>
                        <a href="https://13tv.co.il/item/news/domestic/internal/parking-902956407/" target="_blank" class="btn">Ch 13 News</a>
                        <a href="https://www.mako.co.il/nexter-news/Article-ae43964b891bf71027.htm" target="_blank" class="btn">Mako</a>
                    </div>
                `
            },
            'robotArm': {
                title: '2D Part Orienting',
                html: `
                    <p>Algorithmic robotics: Orienting polygonal parts using a fence without sensors.</p>
                    <p>Implemented in C++ using "Push Plans".</p>
                    <a href="https://www.cgl.cs.tau.ac.il/projects/2d-part-orienting/" target="_blank" class="btn">University Research Page</a>
                `
            },
            'arcade': {
                title: 'The Turing Jest',
                html: `
                    <p>An LMSYS-style arena for Pun-making Large Language Models.</p>
                    <p>Two models enter, one pun leaves.</p>
                    <a href="https://jest.geekip.dev" target="_blank" class="btn">Play Now</a>
                `
            },
            'typewriter': {
                title: 'Rhymes of Israel',
                html: `
                    <p>A Chrome Extension that rewrites news headlines into rhymes.</p>
                    <p>Injects humor into the daily news cycle.</p>
                    <a href="https://chromewebstore.google.com/detail/eainginjgdkpgolpjniijdihfbeeeklb" target="_blank" class="btn">Add to Chrome</a>
                `
            },
            'monitor': {
                title: 'The Meta Portfolio',
                html: `
                    <p>You are here. Recursion depth: 1.</p>
                    <p>Architected by AI, curated by Geva.</p>
                    <a href="https://geekip.dev" target="_blank" class="btn">geekip.dev</a>
                `
            }
        };

        // --- 2. INITIALIZATION ---

        function init() {
            // Scene Setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(colors.floor);
            scene.fog = new THREE.FogExp2(colors.floor, 0.02);

            // Camera (Isometric)
            const aspect = window.innerWidth / window.innerHeight;
            const d = 25;
            camera = new THREE.OrthographicCamera(-d * aspect, d * aspect, d, -d, 1, 1000);
            camera.position.set(20, 20, 20); // 45 degree angle
            camera.lookAt(scene.position);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Interactions
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Lights
            setupLights();

            // Build Room
            createRoom();

            // Event Listeners
            window.addEventListener('resize', onWindowResize);
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('click', onClick);

            // Animation Loop
            animate();
        }

        // --- 3. SCENE BUILDING ---

        function setupLights() {
            const ambient = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambient);

            // Mouse follower light (Flashlight)
            spotlight = new THREE.SpotLight(0xffffff, 3);
            spotlight.position.set(20, 40, 20);
            spotlight.angle = 0.3;
            spotlight.penumbra = 0.5;
            spotlight.castShadow = true;
            spotlight.shadow.mapSize.width = 1024;
            spotlight.shadow.mapSize.height = 1024;
            scene.add(spotlight);
            scene.add(spotlight.target);

            // Static Scene Lights (Neon Accents)
            const deskLight = new THREE.PointLight(colors.neonBlue, 2, 10);
            deskLight.position.set(0, 5, 0);
            scene.add(deskLight);
        }

        function createRoom() {
            roomGroup = new THREE.Group();
            scene.add(roomGroup);

            // 1. Grid Floor
            const gridHelper = new THREE.GridHelper(100, 50, 0x1e293b, 0x0f172a);
            gridHelper.position.y = -0.1;
            roomGroup.add(gridHelper);

            // Floor Plane (for shadows)
            const planeGeo = new THREE.PlaneGeometry(100, 100);
            const planeMat = new THREE.MeshStandardMaterial({ 
                color: colors.floor, 
                roughness: 0.8,
                metalness: 0.2
            });
            const plane = new THREE.Mesh(planeGeo, planeMat);
            plane.rotation.x = -Math.PI / 2;
            plane.receiveShadow = true;
            roomGroup.add(plane);

            // 2. Desk
            const deskGeo = new THREE.BoxGeometry(16, 1, 8);
            const deskMat = new THREE.MeshStandardMaterial({ color: 0x334155 });
            const desk = new THREE.Mesh(deskGeo, deskMat);
            desk.position.set(0, 3, 0);
            desk.castShadow = true;
            desk.receiveShadow = true;
            roomGroup.add(desk);

            // Desk Legs
            const legGeo = new THREE.BoxGeometry(1, 4, 1);
            [-7, 7].forEach(x => {
                [-3, 3].forEach(z => {
                    const leg = new THREE.Mesh(legGeo, deskMat);
                    leg.position.set(x, 1, z);
                    desk.add(leg); // Parent to desk slightly wrong pos visually, keep separate
                    roomGroup.add(leg);
                    leg.position.set(x, 1, z);
                });
            });

            // 3. Monitor (The Meta Portfolio)
            monitor = createInteractiveObject('monitor', 0, 0, 0); // Placeholder vector
            const monBase = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 2), new THREE.MeshStandardMaterial({color:0x000000}));
            const monStand = new THREE.Mesh(new THREE.BoxGeometry(0.5, 2, 0.5), new THREE.MeshStandardMaterial({color:0x000000}));
            const monScreen = new THREE.Mesh(new THREE.BoxGeometry(7, 4, 0.5), new THREE.MeshStandardMaterial({color:0x111111}));
            
            // Screen Face (The recursive effect simulated)
            const screenFace = new THREE.Mesh(
                new THREE.PlaneGeometry(6.5, 3.5), 
                new THREE.MeshStandardMaterial({ 
                    color: colors.neonBlue, 
                    emissive: colors.neonBlue, 
                    emissiveIntensity: 0.2 
                })
            );
            screenFace.position.z = 0.26;
            monScreen.add(screenFace);
            
            monBase.position.y = 3.6;
            monStand.position.y = 4.6;
            monScreen.position.y = 6.5;
            
            monitor.add(monBase, monStand, monScreen);
            monitor.userData.hoverY = 0; // No levitation
            roomGroup.add(monitor);


            // 4. Turntable (GlglStats)
            turntable = createInteractiveObject('turntable', -6, 3.5, 2);
            const ttBase = new THREE.Mesh(new THREE.BoxGeometry(3, 0.5, 3), new THREE.MeshStandardMaterial({color: 0x885522}));
            const record = new THREE.Mesh(
                new THREE.CylinderGeometry(1.2, 1.2, 0.1, 32), 
                new THREE.MeshStandardMaterial({color: 0x111111})
            );
            record.position.y = 0.3;
            const label = new THREE.Mesh(
                new THREE.CylinderGeometry(0.4, 0.4, 0.11, 32),
                new THREE.MeshStandardMaterial({color: colors.neonYellow, emissive: colors.neonYellow, emissiveIntensity: 0.5})
            );
            label.position.y = 0.3;
            // Tonearm
            const arm = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 1.5), new THREE.MeshStandardMaterial({color: 0xcccc}));
            arm.position.set(1, 0.4, 0);
            arm.rotation.y = -0.5;

            turntable.add(ttBase, record, label, arm);
            // Animation hook
            turntable.userData.animator = (time) => {
                record.rotation.y = time * 2;
                label.rotation.y = time * 2;
            };
            roomGroup.add(turntable);

            // 5. Arcade (Turing Jest)
            arcade = createInteractiveObject('arcade', -12, 0, -10);
            const cabGeo = new THREE.BoxGeometry(5, 12, 5);
            const cabMat = new THREE.MeshStandardMaterial({color: 0x220033});
            const cab = new THREE.Mesh(cabGeo, cabMat);
            cab.position.y = 6;
            
            const screenGeo = new THREE.PlaneGeometry(3, 3);
            const screenMat = new THREE.MeshStandardMaterial({
                color: colors.neonPurple,
                emissive: colors.neonPurple,
                emissiveIntensity: 0.8
            });
            const arScreen = new THREE.Mesh(screenGeo, screenMat);
            arScreen.position.set(0, 8, 2.51);
            
            // Joystick
            const stick = new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshStandardMaterial({color: 'red'}));
            stick.position.set(-1, 6.5, 2.5);
            
            arcade.add(cab, arScreen, stick);
            arcade.rotation.y = Math.PI / 4;
            roomGroup.add(arcade);

            // 6. Wall Map (Ahuzat Dibuk)
            wallMap = createInteractiveObject('wallMap', 0, 10, -8);
            const holoPlane = new THREE.Mesh(
                new THREE.PlaneGeometry(8, 5),
                new THREE.MeshStandardMaterial({
                    color: colors.neonGreen,
                    transparent: true,
                    opacity: 0.3,
                    side: THREE.DoubleSide
                })
            );
            // Floating particles visual
            const mapBorder = new THREE.Mesh(new THREE.BoxGeometry(8.2, 5.2, 0.1), new THREE.MeshStandardMaterial({color: 0x444444}));
            wallMap.add(mapBorder, holoPlane);
            roomGroup.add(wallMap);

            // 7. Robot Arm (2D Part Orienting)
            robotArm = createInteractiveObject('robotArm', 6, 3.5, 0);
            const yellowMat = new THREE.MeshStandardMaterial({color: 0xffaa00});
            const rBase = new THREE.Mesh(new THREE.CylinderGeometry(1, 1.2, 0.5), new THREE.MeshStandardMaterial({color: 0x333333}));
            const rLimb1 = new THREE.Mesh(new THREE.BoxGeometry(0.5, 3, 0.5), yellowMat);
            rLimb1.position.y = 1.5;
            const rJoint = new THREE.Mesh(new THREE.SphereGeometry(0.6), new THREE.MeshStandardMaterial({color: 0x333333}));
            rJoint.position.y = 3;
            const rLimb2 = new THREE.Mesh(new THREE.BoxGeometry(0.4, 2, 0.4), yellowMat);
            rLimb2.position.set(0.5, 3.5, 0);
            rLimb2.rotation.z = -0.5;
            
            // The Polygon being held
            const polygon = new THREE.Mesh(new THREE.OctahedronGeometry(0.5), new THREE.MeshStandardMaterial({color: colors.neonBlue, wireframe: true}));
            polygon.position.set(1.2, 4.2, 0);

            robotArm.add(rBase, rLimb1, rJoint, rLimb2, polygon);
            robotArm.userData.animator = (time) => {
                polygon.rotation.x = time;
                polygon.rotation.y = time;
                rLimb2.rotation.z = -0.5 + Math.sin(time) * 0.2;
                polygon.position.y = 4.2 + Math.sin(time) * 0.1;
            };
            roomGroup.add(robotArm);

            // 8. Typewriter (Rhymes)
            typewriter = createInteractiveObject('typewriter', 5, 3.5, 3);
            const twBase = new THREE.Mesh(new THREE.BoxGeometry(2, 0.5, 2), new THREE.MeshStandardMaterial({color: 0x222222}));
            const twPaper = new THREE.Mesh(new THREE.PlaneGeometry(1.5, 2), new THREE.MeshStandardMaterial({color: colors.neonBlue, transparent: true, opacity: 0.6, side: THREE.DoubleSide}));
            twPaper.position.set(0, 1.5, -0.5);
            twPaper.rotation.x = -0.2;
            
            typewriter.add(twBase, twPaper);
            roomGroup.add(typewriter);

            // 9. Social Shelf
            createSocialShelf();
        }

        function createSocialShelf() {
            // Shelf board
            const shelf = new THREE.Mesh(new THREE.BoxGeometry(2, 8, 2), new THREE.MeshStandardMaterial({color: 0x333333}));
            shelf.position.set(14, 2, 0); // Wall side
            roomGroup.add(shelf); // Static

            // Social Items (Interactive)
            // GitHub (Octocat abstract - Tetrahedron)
            const github = createInteractiveObject('github', 14, 5, -2);
            const gShape = new THREE.Mesh(
                new THREE.OctahedronGeometry(0.8), 
                new THREE.MeshStandardMaterial({color: 0xffffff, emissive: 0x333333})
            );
            github.add(gShape);
            github.userData.link = 'https://github.com/gevak';
            github.userData.animator = (time) => { gShape.rotation.y = time; };
            roomGroup.add(github);

            // LinkedIn (Blue Block)
            const linkedin = createInteractiveObject('linkedin', 14, 3, 0);
            const lShape = new THREE.Mesh(
                new THREE.BoxGeometry(1, 1, 1), 
                new THREE.MeshStandardMaterial({color: 0x0077b5, emissive: 0x004488})
            );
            linkedin.add(lShape);
            linkedin.userData.link = 'https://linkedin.com/in/gevakip';
            linkedin.userData.animator = (time) => { lShape.rotation.x = time * 0.5; lShape.rotation.z = time * 0.5; };
            roomGroup.add(linkedin);

            // Facebook (Blue Cube F)
            const fb = createInteractiveObject('facebook', 14, 1, 2);
            const fShape = new THREE.Mesh(
                new THREE.BoxGeometry(1, 1, 1), 
                new THREE.MeshStandardMaterial({color: 0x1877f2, emissive: 0x1877f2, emissiveIntensity: 0.3})
            );
            fb.add(fShape);
            fb.userData.link = 'https://facebook.com/geva.kipper';
            roomGroup.add(fb);
        }

        // Helper to make an object interactive
        function createInteractiveObject(name, x, y, z) {
            const group = new THREE.Group();
            group.position.set(x, y, z);
            group.name = name;
            group.userData = { 
                originalY: y,
                isHovered: false 
            };
            interactiveObjects.push(group);
            return group;
        }

        // --- 4. LOGIC & ANIMATION ---

        function onMouseMove(event) {
            // Update Mouse Vector
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // Update Tooltip position
            const tooltip = document.getElementById('cursor-tooltip');
            tooltip.style.left = event.clientX + 'px';
            tooltip.style.top = event.clientY + 'px';

            // Move Spotlight
            if(spotlight) {
                // Project mouse to 3D plane
                const vector = new THREE.Vector3(mouse.x, mouse.y, 0.5);
                vector.unproject(camera);
                const dir = vector.sub(camera.position).normalize();
                const distance = -camera.position.y / dir.y;
                const pos = camera.position.clone().add(dir.multiplyScalar(distance));
                
                spotlight.target.position.copy(pos);
            }
        }

        function onClick(event) {
            if (event.target.closest('#modal-overlay')) return; // Ignore clicks on modal layer
            
            if (hoveredObject) {
                const name = hoveredObject.name;

                // Handle Social Links (Direct Open)
                if (['github', 'linkedin', 'facebook'].includes(name)) {
                    window.open(hoveredObject.userData.link, '_blank');
                    return;
                }

                // Handle Modals
                if (projectData[name]) {
                    // Special Animation for Monitor
                    if (name === 'monitor') {
                        // Zoom effect simulation
                        import('https://unpkg.com/gsap@3.12.5/index.js').then((module) => {
                           // Simple GSAP check handled via CDN script tag global
                           gsap.to(camera, { zoom: 5, duration: 1, onUpdate: () => camera.updateProjectionMatrix() });
                           setTimeout(() => {
                               openModal(name);
                               // Reset zoom after modal opens
                               gsap.to(camera, { zoom: 1, duration: 0.5, delay: 0.5, onUpdate: () => camera.updateProjectionMatrix() });
                           }, 1000);
                        });
                    } else {
                        openModal(name);
                    }
                }
            }
        }

        function openModal(key) {
            const data = projectData[key];
            const inner = document.getElementById('modal-inner');
            inner.innerHTML = `
                <h3 class="modal-title">${data.title}</h3>
                <div class="modal-body">${data.html}</div>
            `;
            const overlay = document.getElementById('modal-overlay');
            overlay.classList.add('active');
        }

        function animate() {
            requestAnimationFrame(animate);

            const time = clock.getElapsedTime();

            // Raycasting
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects, true);

            // Reset hover state
            if (hoveredObject && (!intersects.length || !isDescendant(hoveredObject, intersects[0].object))) {
                document.body.style.cursor = 'default';
                document.getElementById('cursor-tooltip').style.opacity = 0;
                // Reset scale
                hoveredObject.scale.set(1, 1, 1);
                hoveredObject = null;
            }

            if (intersects.length) {
                // Find the parent group in interactiveObjects
                let obj = intersects[0].object;
                while(obj.parent && !interactiveObjects.includes(obj)) {
                    obj = obj.parent;
                }

                if (interactiveObjects.includes(obj)) {
                    hoveredObject = obj;
                    document.body.style.cursor = 'pointer';
                    document.getElementById('cursor-tooltip').style.opacity = 1;
                    
                    // Hover Effect
                    obj.scale.set(1.1, 1.1, 1.1);
                }
            }

            // Object-specific animations
            interactiveObjects.forEach(obj => {
                // Levitation (Sine wave)
                if (obj.userData.originalY) {
                    obj.position.y = obj.userData.originalY + Math.sin(time * 2) * 0.1;
                    
                    // Specific complex animations
                    if (obj.userData.animator) {
                        obj.userData.animator(time);
                    }
                }
            });

            // Ahuzat Dibuk - Hologram Pulse
            if(wallMap) {
                wallMap.children[1].material.opacity = 0.3 + Math.sin(time * 5) * 0.1;
            }

            renderer.render(scene, camera);
        }

        // Helper to check object hierarchy
        function isDescendant(parent, child) {
            let node = child;
            while (node != null) {
                if (node === parent) return true;
                node = node.parent;
            }
            return false;
        }

        function onWindowResize() {
            const aspect = window.innerWidth / window.innerHeight;
            const d = 25;
            camera.left = -d * aspect;
            camera.right = d * aspect;
            camera.top = d;
            camera.bottom = -d;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- 5. UI LOGIC (Typewriter & Timer) ---

        // Typewriter Effect
        const typeText = "This digital architecture is hallucinated daily by AI. Its form is ephemeral.";
        const typeEl = document.getElementById('typewriter-text');
        let typeIdx = 0;

        function typeWriter() {
            if (typeIdx < typeText.length) {
                typeEl.innerHTML += typeText.charAt(typeIdx);
                typeIdx++;
                setTimeout(typeWriter, 50 + Math.random() * 50);
            } else {
                // Glitch effect loop
                setInterval(() => {
                    typeEl.classList.add('glitch');
                    setTimeout(() => typeEl.classList.remove('glitch'), 200);
                }, 4000);
            }
        }

        // Countdown Timer relative to 2026-01-18 01:18:43
        const targetDate = new Date('2026-01-18T01:18:43').getTime();
        const timerEl = document.getElementById('epoch-timer');

        function updateTimer() {
            const now = new Date().getTime();
            const distance = now - targetDate; // Elapsed (if positive) or Remaining (if negative)
            
            const isFuture = distance < 0;
            const absDist = Math.abs(distance);
            
            const days = Math.floor(absDist / (1000 * 60 * 60 * 24));
            const hours = Math.floor((absDist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((absDist % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((absDist % (1000 * 60)) / 1000);
            const ms = Math.floor((absDist % 1000));

            const prefix = isFuture ? "T-MINUS " : "ELAPSED +";
            timerEl.innerText = `${prefix}${days}:${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}.${ms.toString().padStart(3,'0')}`;

            requestAnimationFrame(updateTimer);
        }

        // Session ID Logic
        document.getElementById('session-id').innerText = '0x' + Math.floor(Math.random()*16777215).toString(16).toUpperCase();

        // Close Modal Logic
        document.querySelector('.modal-close').addEventListener('click', () => {
            document.getElementById('modal-overlay').classList.remove('active');
        });

        // Start
        init();
        setTimeout(typeWriter, 1000);
        updateTimer();

    </script>
<!-- Add this block to embed the like button -->
    <script src="/static/js/like_button.js"></script>
    <script>
        LikeButton.init({
          pageId: "20260118",
          position: "bottom-right", // Options: bottom-right, bottom-left, top-right, top-left
        });
    </script>

</body>
</html>