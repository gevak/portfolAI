<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geva Kipper | Interactive Portfolio</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --accent-color: #ffffff;
            --glow-color: #ffffff;
            --card-bg: rgba(20, 20, 20, 0.85);
            --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: var(--font-main);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #scene-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        #scene-container:active {
            cursor: grabbing;
        }

        /* --- Header --- */
        #header {
            position: fixed;
            top: 5vh;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            color: var(--text-color);
            opacity: 0;
            animation: fadeInHeader 2.5s 1.5s forwards;
            pointer-events: none;
        }
        
        @keyframes fadeInHeader {
            from { opacity: 0; filter: blur(10px); }
            to   { opacity: 1; filter: blur(0px); }
        }

        #header h1 {
            font-size: 2.5rem;
            margin: 0;
            font-weight: 600;
            letter-spacing: 1px;
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        #header p {
            font-size: 1.1rem;
            margin: 8px 0;
            font-weight: 300;
        }

        #subtitle {
            margin-top: 15px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: #a0a0a0;
        }
        
        /* Typing effect for subtitle */
        #subtitle-text::after {
            content: '█';
            animation: blink-caret 1s step-end infinite;
        }
        
        @keyframes blink-caret {
            from, to { opacity: 1; }
            50% { opacity: 0; }
        }

        /* --- Footer --- */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px 20px;
            background: linear-gradient(180deg, rgba(26,26,26,0) 0%, rgba(26,26,26,0.8) 100%);
            text-align: center;
            z-index: 10;
            font-size: 0.8rem;
            color: #888;
            pointer-events: none;
        }

        footer p {
            margin: 2px 0;
        }

        /* --- Tooltip --- */
        #tooltip {
            position: fixed;
            display: none;
            padding: 8px 12px;
            background-color: var(--card-bg);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: var(--accent-color);
            font-size: 0.9rem;
            z-index: 100;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        /* --- Info Card Modal --- */
        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 98;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #modal-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        #info-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transform: scale(0.95);
            transition: transform 0.5s ease-in-out;
        }

        #modal-overlay.visible #info-card {
            transform: scale(1);
        }

        #info-card h2 {
            margin: 0 0 15px 0;
            color: var(--accent-color);
            font-size: 1.8rem;
        }

        #info-card p {
            margin: 0 0 25px 0;
            line-height: 1.6;
            color: var(--text-color);
        }
        
        #card-content {
            max-height: 60vh;
            overflow-y: auto;
        }
        
        #card-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .card-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px 18px;
            text-decoration: none;
            color: var(--accent-color);
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            font-weight: 500;
            transition: background-color 0.2s, transform 0.2s;
            cursor: pointer;
        }

        .card-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .card-button img, .card-button svg {
            margin-right: 8px;
            height: 16px;
            width: auto;
        }

        #close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2rem;
            color: #aaa;
            cursor: pointer;
            transition: color 0.2s;
            line-height: 1;
        }

        #close-modal:hover {
            color: var(--accent-color);
        }

        #youtube-player-container {
            display: none;
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            margin-top: 20px;
        }

        #youtube-player-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .logo-icon{
            filter: invert(1);
        }

        @media (max-width: 600px) {
            #header h1 { font-size: 1.8rem; }
            #header p { font-size: 1rem; }
            #info-card { padding: 20px; }
            #info-card h2 { font-size: 1.5rem; }
            #card-buttons { flex-direction: column; }
        }

    </style>
</head>
<body>
    <div id="scene-container"></div>
    
    <div id="header">
        <h1>Geva Kipper</h1>
        <p>A Software Engineer at Google, crafting the future of developer tooling.</p>
        <div id="subtitle">
            <span id="subtitle-text"></span>
        </div>
    </div>
    
    <div id="tooltip"></div>

    <div id="modal-overlay">
        <div id="info-card">
            <span id="close-modal">&times;</span>
            <div id="card-content">
                <h2 id="card-title"></h2>
                <p id="card-description"></p>
                <div id="card-buttons"></div>
                <div id="youtube-player-container">
                    <iframe id="youtube-player" src="" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>This interactive experience was designed and structured by a generative AI model.</p>
        <p>Time since last AI re-design: <span id="stopwatch">00:00:00</span></p>
    </footer>

    <!-- JS Libraries -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
            }
        }
    </script>

    <!-- Main Application Script -->
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- Core Scene Setup ---
        let scene, camera, renderer, controls;
        let interactiveObjects = [];
        let hoveredObject = null;
        let isFocused = false;
        let returnState = {};

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        
        const tooltip = document.getElementById('tooltip');
        const modalOverlay = document.getElementById('modal-overlay');
        const closeModalBtn = document.getElementById('close-modal');

        // --- Base64 Encoded Assets ---
        const ASSETS = {
            github: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA5OCA5NiI+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00OC44NTQgMEEyNC43NDggMjQuNzQ4IDAgMCAwIDI0LjEgNDguOTczYzAgMTEuODEzIDcuNTQ3IDIxLjgyMyAxNy45NDcgMjUuMzMyLjc3My4xNDEgMS4wNTMtLjMzMyAxLjA1My0uNzQsMC0uMzY0LS4wMTMtMi4xMy0uMDEzLTQuMTY4IDAgMC03LjI5MyAxLjU3My04LjgzNS0uNzc3cy0uODk4LTMuMzMyLS44OTgtMy4zMzJjLTEuMjI3LTIuMzA0LTMuMjctMS4xMjctMy4yNy0xLjEyN0wxMi41OCA2My45M2MuMjU0Ljc4LjkyIDEuMjUgMS41NyAxLjQ4IDEuNjQzIDEuMTEzIDMuNTMyLjYxMyAzLjUzMi42MTNzMi4xMTgtLjc4IDIuOTEzLTEuODAzYy42NTQtMi4zMjMgMS44ODMtMy44NSAyLjYxMy00LjU5LTEwLjMxMy0xLjE3My0xMi4zNDctNS41ODctMTIuMzQ3LTEzLjE1MyAwLTMuNDIuOTk0LTYuMzc0IDIuOTIzLTguODItLjQwNy0xLjM1My0xLjI2Ny00LjYxMy4yMDctOC45ODEgMCAwIDMuOTEzLTEuMTEzIDEyLjA1MyA0LjM4NiAzLjc1LTEuMDQgNy45NC0xLjU1MyAxMi4zNTMtMS41NTNzOC42MDMgLjUxMyAxMi4zNTMgMS41NTNjOC4xNC01LjUgMTEuOTQ3LTQuMzgzIDExLjk0Ny00LjM4MyAxLjQ3MyA0LjM2OC42MTMgNy42MjcuMjA3IDguOTguNTUgMS4xNzMgMi45MjcgNS40IDIuOTI3IDguODIgMCA3Ljc4Ni0yLjI1MyAxMS45OC0xMi41NTMgMTMuMTUyLjc3My44OCAxLjc3MyAyLjM2IDEuNzc0IDQuMDUzLS4wMTMgMi4wMTQtLjAxMyA2LjY4LS4wMTMgNy44MDcgMCAuNDA1LjI3My44ODcgMS4wNTQgLjc0NiAxMC40MDctMy41MDcgMTcuOTQ3LTEzLjUxOCAxNy45NDctMjUuMzE4QzcyLjQ5MiAyNC4wOTggNTQuNzk2IDAgNDguODU0IDB6Ii8+PC9zdmc+',
            linkedin: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIxLjI4IDE4LjQ4aC0zLjE2di01LjM3YzAtMS4yOC0uMDItMi45Mi0xLjc4LTIuOTJzLTIuMDYgMS4zNy0yLjA2IDIuODJ2NS40N2gtMy4xNlY5LjEyaDMuMDN2MS4zOWgxLjA0YzAuNDItMC44IDEuNDUtMS42MyAyLjk5LTEuNjNzMy41NSAxIDMuNTUgMy45MnYzLjc4ek02LjUzIDcuNzNjLTEuMTQgMC0yLjA2LS45Mi0yLjA2LTIuMDZzLjkyLTIuMDYgMi4wNi0yLjA2IDIuMDYuOTIgMi4wNiAyLjA2LS45MSAyLjA2LTIuMDYgMi4wNnpNOC4xMiA5LjEyaC0zLjE2djkuMzZoMy4xNlY5LjEyeiIvPjwvc3ZnPg==',
            facebook: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIyIDIwdi0xNmMwLTEuMS0uOS0yLTItMkg0Yy0xLjEgMC0yIC45LTIgMnYxNmMwIDEuMS45IDIgMiAyaDE2YzEuMSAwIDItLjkgMi0yem0tNF8uemgtMS41YzAtLjgyLS4zMy0xLjM4LS43OC0xLjc1Yy0uNDQtLjM2LTEuMDQtLjU0LTEuNzgtLjU0aC0xcHYyLjVoMWMyLjIgMCAzLjQtMS41IDMuNC0zLjh2LTQuMmgzVjEySDIyVjkuODZoLTJoMS41VjUuNWgtMS41VjRoLTN2MS41SDIuNVY5aDB6Ii8+',
            chrome: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHBhdGggZmlsbD0iI0Y0NDMzNiIgZD0iTTIwIDI0bDE4LTEzLjVoLTI3eiIvPjxwYXRoIGZpbGw9IiNGQkJDMDQiIGQ9Ik00MSA0MC41bC0yMy4xLTEuMmwtNy4xLTEybDMuNS0xOS44bDI2LjcgMy41eiIvPjxwYXRoIGZpbGw9IiM0Q0FGNTAiIGQ9Ik0xMC44IDExTDQgMjJsMTYgMTcuNWw5LjItMjUuNXoiLz48Y2lyY2xlIGN4PSIyNCIgY3k9IjI0IiByPSI5IiBmaWxsPSIjNDI4NUY0Ii8+PC9zdmc+',
        };
        const textureLoader = new THREE.TextureLoader();

        // --- Project Data ---
        const projects = [
            { id: 'glglstats', name: 'GlglStats', description: 'Real-time analysis of Israeli army radio (Galgalatz) playlists. I reverse engineered their song API to track and visualize data over time, becoming the ultimate source for Israeli radio statistics.', links: [ { text: 'Visit GlglStats', url: 'https://glglstats.geekip.dev' }, { text: 'Watch PyData Talk', action: 'youtube', url: 'https://www.youtube.com/embed/jrKAtOsj1Lo' } ], targetPos: new THREE.Vector3(-0.8, 1.2, 0.5), targetLookAt: new THREE.Vector3(-0.35, 0.95, -0.05) },
            { id: 'ahuzatdibuk', name: 'Ahuzat Dibuk', description: 'A viral data-journalism project exposing "Ahuzat HaHof", a Tel Aviv parking lot that issued millions in fines. By analyzing public data, I created a "heat map" of fines, sparking a media frenzy and public debate.', links: [ { text: 'As Seen On: Channel 13', url: 'https://13tv.co.il/item/news/domestic/internal/parking-902956407/' }, { text: 'As Seen On: Mako', url: 'https://www.mako.co.il/nexter-news/Article-ae43964b891bf71027.htm' }, { text: 'The Original Post', url: 'https://www.facebook.com/groups/secrettelaviv/posts/10159636301195943', icon: ASSETS.facebook } ], targetPos: new THREE.Vector3(-0.6, 1, 1), targetLookAt: new THREE.Vector3(0, 0.9, 0.4) },
            { id: 'partorienting', name: '2D Part Orienting', description: 'A C++ implementation of a computational geometry algorithm to determine all stable resting poses of a 2D polygonal part. This academic project for Tel-Aviv University delves into the physics and geometry of object stability.', links: [ { text: 'View The Algorithm & Code', url: 'https://www.cgl.cs.tau.ac.il/projects/2d-part-orienting/' } ], targetPos: new THREE.Vector3(0.5, 1.2, 1), targetLookAt: new THREE.Vector3(0.5, 0.9, 0.3) },
            { id: 'turingjest', name: 'The Turing Jest', description: 'An LLM-powered arena where you chat with two agents — one human, one AI — and must identify the machine. It\'s a modern Turing Test designed to explore the nuances of digital conversation and AI deception.', links: [ { text: 'Try The Arena', url: 'https://jest.geekip.dev' } ], targetPos: new THREE.Vector3(1.1, 1.1, 0.5), targetLookAt: new THREE.Vector3(0.8, 0.95, -0.1) },
            { id: 'rhymes', name: 'Rhymes of Israel', description: 'A Chrome extension that finds Hebrew rhymes for any selected word. It integrates seamlessly into the browser, providing a handy tool for poets, songwriters, and writers in Hebrew.', links: [ { text: 'Install the Extension', url: 'https://chromewebstore.google.com/detail/eainginjgdkpgolpjniijdihfbeeeklb', icon: ASSETS.chrome } ], targetPos: new THREE.Vector3(0.8, 1.1, -0.7), targetLookAt: new THREE.Vector3(0.2, 0.9, -0.3) },
            { id: 'portfolio', name: 'The Portfolio Project', description: "You're already here! This portfolio is a project in itself, blending 3D interactivity with AI-driven design concepts to create a unique, explorable space.", links: [ { text: 'Visit Main Site', url: 'https://geekip.dev' } ], targetPos: new THREE.Vector3(-1.1, 1.2, -0.7), targetLookAt: new THREE.Vector3(-0.6, 0.95, -0.3) },
        ];


        function init() {
            // --- Renderer and Scene ---
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setAnimationLoop(animate);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('scene-container').appendChild(renderer.domElement);

            // --- Camera ---
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 1.8, 3.5);

            // --- Lights ---
            const ambient = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambient);

            const deskLampLight = new THREE.PointLight(0xffeebb, 1, 10, 1.5);
            deskLampLight.position.set(-0.8, 1.5, 0);
            deskLampLight.castShadow = true;
            deskLampLight.shadow.radius = 4;
            deskLampLight.shadow.bias = -0.0005;
            deskLampLight.shadow.mapSize.width = 1024;
            deskLampLight.shadow.mapSize.height = 1024;
            scene.add(deskLampLight);
            
            // --- Controls ---
            controls = new OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 0.9, 0);
            controls.enableDamping = true;
            controls.minDistance = 1.5;
            controls.maxDistance = 5;
            controls.minPolarAngle = Math.PI / 4;
            controls.maxPolarAngle = Math.PI / 2.2;
            controls.enablePan = false;

            // --- Create Scene Objects ---
            createDesk();
            createProjects();
            createSocialLinks();

            // --- Initial Animations ---
            initialCameraAnimation();
            startTypewriter();

            // --- Event Listeners ---
            window.addEventListener('resize', onWindowResize, false);
            window.addEventListener('mousemove', onMouseMove, false);
            window.addEventListener('click', onClick, false);
            closeModalBtn.addEventListener('click', unfocus, false);
        }

        function createDesk() {
            // Desk Top
            const deskTopGeo = new THREE.BoxGeometry(3, 0.08, 1.5);
            const deskTopMat = new THREE.MeshStandardMaterial({ color: 0xdeb887, roughness: 0.8, metalness: 0.1 });
            const deskTop = new THREE.Mesh(deskTopGeo, deskTopMat);
            deskTop.position.y = 0.8;
            deskTop.receiveShadow = true;
            scene.add(deskTop);

            // Legs
            const legGeo = new THREE.CylinderGeometry(0.04, 0.04, 0.8, 16);
            const legMat = new THREE.MeshStandardMaterial({ color: 0x222222, roughness: 0.5, metalness: 0.5 });
            const legPositions = [
                { x: -1.3, z: -0.6 }, { x: 1.3, z: -0.6 },
                { x: -1.3, z: 0.6 }, { x: 1.3, z: 0.6 }
            ];
            legPositions.forEach(pos => {
                const leg = new THREE.Mesh(legGeo, legMat);
                leg.position.set(pos.x, 0.4, pos.z);
                leg.castShadow = true;
                scene.add(leg);
            });
        }
        
        function createProjectObject(data) {
            const group = new THREE.Group();
            group.position.set(0, 0.84, 0);
            
            let mainInteractiveMesh;

            switch(data.id) {
                case 'glglstats': // Headphones and Tablet
                    const headphoneMat = new THREE.MeshStandardMaterial({ color: 0x333333, roughness: 0.4, metalness: 0.2 });
                    
                    // Band
                    const curve = new THREE.CatmullRomCurve3([
                        new THREE.Vector3(0, 0.1, 0),
                        new THREE.Vector3(0, 0.2, 0),
                        new THREE.Vector3(0.05, 0.22, 0),
                        new THREE.Vector3(0.1, 0.2, 0),
                        new THREE.Vector3(0.1, 0.1, 0)
                    ]);
                    const bandGeo = new THREE.TubeGeometry(curve, 20, 0.015, 8, false);
                    const band = new THREE.Mesh(bandGeo, headphoneMat);
                    
                    // Earpieces
                    const earpieceGeo = new THREE.CylinderGeometry(0.05, 0.05, 0.03, 32);
                    const earpiece1 = new THREE.Mesh(earpieceGeo, headphoneMat);
                    earpiece1.rotation.z = Math.PI / 2;
                    earpiece1.position.set(-0.015, 0.1, 0);

                    const earpiece2 = earpiece1.clone();
                    earpiece2.position.set(0.115, 0.1, 0);
                    
                    const headphones = new THREE.Group();
                    headphones.add(band, earpiece1, earpiece2);
                    headphones.position.set(-0.45, 0, 0.1);
                    headphones.rotation.y = -0.5;
                    group.add(headphones);
                    
                    // Tablet
                    const tabletGeo = new THREE.BoxGeometry(0.2, 0.28, 0.01);
                    const waveformCanvas = document.createElement('canvas');
                    waveformCanvas.width = 128;
                    waveformCanvas.height = 256;
                    const waveformCtx = waveformCanvas.getContext('2d');
                    waveformCtx.fillStyle = '#111';
                    waveformCtx.fillRect(0,0,128,256);
                    waveformCtx.fillStyle = '#4D96FF';
                    for(let i = 0; i < 256; i+=4){
                        const h = Math.random() * 80 + 20;
                        waveformCtx.fillRect(0, i, h, 2);
                    }
                    const tabletScreenTex = new THREE.CanvasTexture(waveformCanvas);
                    
                    const tabletMats = [
                        new THREE.MeshStandardMaterial({color: 0x222222}), new THREE.MeshStandardMaterial({color: 0x222222}),
                        new THREE.MeshStandardMaterial({color: 0x222222}), new THREE.MeshStandardMaterial({color: 0x222222}),
                        new THREE.MeshStandardMaterial({map: tabletScreenTex, emissive: 0x4D96FF, emissiveIntensity: 0.5}),
                        new THREE.MeshStandardMaterial({color: 0x222222}),
                    ];
                    const tablet = new THREE.Mesh(tabletGeo, tabletMats);
                    tablet.position.set(-0.25, 0.005, 0.05);
                    tablet.rotation.x = -Math.PI / 2;
                    group.add(tablet);

                    mainInteractiveMesh = headphones;
                    break;
                
                case 'ahuzatdibuk': // Car and map
                    const mapGeo = new THREE.PlaneGeometry(0.35, 0.25);
                    const mapCanvas = document.createElement('canvas');
                    mapCanvas.width=256; mapCanvas.height=256;
                    const mapCtx = mapCanvas.getContext('2d');
                    mapCtx.fillStyle = '#EAE6D9'; mapCtx.fillRect(0,0,256,256);
                    mapCtx.strokeStyle = '#B4B0A0'; mapCtx.lineWidth = 2;
                    for(let i=0; i<10; i++){ mapCtx.strokeRect(Math.random()*256, Math.random()*256, Math.random()*50, Math.random()*50); }
                    const gradient = mapCtx.createRadialGradient(128,128,0,128,128,100);
                    gradient.addColorStop(0, 'rgba(255, 100, 0, 0.8)');
                    gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                    mapCtx.fillStyle = gradient; mapCtx.fillRect(0,0,256,256);
                    const mapTex = new THREE.CanvasTexture(mapCanvas);
                    
                    const map = new THREE.Mesh(mapGeo, new THREE.MeshStandardMaterial({map: mapTex}));
                    map.rotation.x = -Math.PI/2;
                    map.position.set(0, 0.001, 0.4);
                    group.add(map);

                    const carMat = new THREE.MeshStandardMaterial({ color: 0xff0000, roughness: 0.3, metalness: 0.2 });
                    const carBodyGeo = new THREE.BoxGeometry(0.1, 0.04, 0.05);
                    const carBody = new THREE.Mesh(carBodyGeo, carMat);
                    carBody.position.set(0, 0.02, 0.4);
                    const carTopGeo = new THREE.BoxGeometry(0.06, 0.03, 0.05);
                    const carTop = new THREE.Mesh(carTopGeo, carMat);
                    carTop.position.set(-0.01, 0.03, 0);
                    carBody.add(carTop);
                    
                    group.add(carBody);
                    mainInteractiveMesh = carBody;
                    break;
                    
                case 'partorienting': // Puzzle and blueprint
                    const blueprintGeo = new THREE.PlaneGeometry(0.4, 0.3);
                    const bpMat = new THREE.MeshStandardMaterial({color: 0xadd8e6,});
                    const blueprint = new THREE.Mesh(blueprintGeo, bpMat);
                    blueprint.rotation.x = -Math.PI / 2;
                    blueprint.position.set(0.5, 0.001, 0.3);
                    group.add(blueprint);
                    
                    const puzzleGeo = new THREE.TorusKnotGeometry(0.05, 0.02, 100, 16, 2, 3);
                    const puzzleMat = new THREE.MeshStandardMaterial({color: 0xcccccc, roughness: 0.1, metalness: 0.9});
                    const puzzle = new THREE.Mesh(puzzleGeo, puzzleMat);
                    puzzle.position.set(0.5, 0.03, 0.3);
                    group.add(puzzle);
                    mainInteractiveMesh = puzzle;
                    break;

                case 'turingjest': // Rubber chicken
                    const chickenMat = new THREE.MeshStandardMaterial({color: 0xFFF44F, roughness: 0.7});
                    const chickenBodyGeo = new THREE.SphereGeometry(0.06, 32, 16);
                    const chickenBody = new THREE.Mesh(chickenBodyGeo, chickenMat);
                    chickenBody.position.set(0.8, 0.06, -0.1);
                    chickenBody.scale.y = 1.3;
                    const chickenHeadGeo = new THREE.SphereGeometry(0.04, 32, 16);
                    const chickenHead = new THREE.Mesh(chickenHeadGeo, chickenMat);
                    chickenHead.position.y = 0.1;
                    chickenBody.add(chickenHead);
                    group.add(chickenBody);
                    mainInteractiveMesh = chickenBody;
                    break;
                
                case 'rhymes': // Tablet and quill
                    const extTabletGeo = new THREE.BoxGeometry(0.25, 0.01, 0.35);
                    const extScreenCanvas = document.createElement('canvas');
                    extScreenCanvas.width = 256; extScreenCanvas.height = 256;
                    const extCtx = extScreenCanvas.getContext('2d');
                    extCtx.fillStyle = '#fff'; extCtx.fillRect(0,0,256,256);
                    extCtx.fillStyle = '#4285F4'; extCtx.fillRect(20,20,216,40);
                    extCtx.fillStyle='#eee'; extCtx.fillRect(20, 80, 216, 156);
                    extCtx.fillStyle='#333'; extCtx.font="16px sans-serif"; extCtx.fillText("Rhymes of Israel", 30, 110);
                    const extScreenTex = new THREE.CanvasTexture(extScreenCanvas);
                    
                    const extTabletMats = [
                        new THREE.MeshStandardMaterial({color: 0xeeeeee}),
                        new THREE.MeshStandardMaterial({color: 0xeeeeee}),
                        new THREE.MeshStandardMaterial({map: extScreenTex}),
                        new THREE.MeshStandardMaterial({color: 0xeeeeee}),
                        new THREE.MeshStandardMaterial({color: 0xeeeeee}),
                        new THREE.MeshStandardMaterial({color: 0xeeeeee}),
                    ];
                    const extTablet = new THREE.Mesh(extTabletGeo, extTabletMats);
                    extTablet.position.set(0.2, 0.005, -0.3);
                    extTablet.rotation.y = 0.3;
                    group.add(extTablet);
                    
                    const quillMat = new THREE.MeshStandardMaterial({color: 0x444444});
                    const quillShaftGeo = new THREE.CylinderGeometry(0.005, 0.002, 0.2, 8);
                    const quillShaft = new THREE.Mesh(quillShaftGeo, quillMat);
                    quillShaft.position.set(0.2, 0.01, -0.3);
                    quillShaft.rotation.z = Math.PI / 2.2;
                    group.add(quillShaft);
                    
                    mainInteractiveMesh = extTablet;
                    break;
                    
                case 'portfolio': // Digital frame
                    const frameGeo = new THREE.BoxGeometry(0.2, 0.15, 0.02);
                    const frameMat = new THREE.MeshStandardMaterial({color: 0x111111});
                    const frame = new THREE.Mesh(frameGeo, frameMat);
                    frame.position.set(-0.6, 0.075, -0.3);
                    frame.rotation.y = 0.5;
                    group.add(frame);
                    mainInteractiveMesh = frame;
                    break;
            }
            
            // Assign data and add to scene
            mainInteractiveMesh.userData = data;
            mainInteractiveMesh.children.forEach(child => child.userData = data);
            
            group.traverse(child => {
                if (child.isMesh) {
                    child.castShadow = true;
                    child.receiveShadow = true;
                }
            });

            scene.add(group);
            interactiveObjects.push(mainInteractiveMesh);
        }

        function createProjects() {
            projects.forEach(p => createProjectObject(p));
        }

        function createSocialLinks() {
            const holderGeo = new THREE.BoxGeometry(0.2, 0.05, 0.01);
            const holderMat = new THREE.MeshStandardMaterial({color:0x1a1a1a, roughness:0.4});
            const holder = new THREE.Mesh(holderGeo, holderMat);
            holder.position.set(0.9, 0.84, 0.5);
            holder.rotation.y = -0.2;
            scene.add(holder);

            const socialLinks = [
                { id: 'github', url: 'https://github.com/gevak', logo: ASSETS.github },
                { id: 'linkedin', url: 'https://linkedin.com/in/gevakip', logo: ASSETS.linkedin },
                { id: 'facebook', url: 'https://facebook.com/geva.kipper', logo: ASSETS.facebook },
            ];
            
            socialLinks.forEach((link, i) => {
                const cardGeo = new THREE.PlaneGeometry(0.1, 0.06);
                const logoTex = textureLoader.load(link.logo);
                const cardMat = new THREE.MeshStandardMaterial({ map: logoTex, transparent: true, side: THREE.DoubleSide });
                const card = new THREE.Mesh(cardGeo, cardMat);
                
                card.position.set(0.9, 0.87 + i * 0.002, 0.505 + i * 0.01);
                card.rotation.set(-0.2, -0.2, -0.1);
                
                card.userData = { isSocial: true, url: link.url };
                interactiveObjects.push(card);
                scene.add(card);
            });
        }
        
        function initialCameraAnimation() {
            const startPos = new THREE.Vector3(-3, 1.5, 3);
            const endPos = new THREE.Vector3(0, 1.8, 3.5);
            camera.position.copy(startPos);
            
            let t = 0;
            const duration = 2500;
            const startTime = Date.now();

            function pan() {
                const elapsed = Date.now() - startTime;
                t = Math.min(1, elapsed / duration);
                const easedT = t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2; // easeInOutQuad
                camera.position.lerpVectors(startPos, endPos, easedT);
                if (t < 1) requestAnimationFrame(pan);
            }
            setTimeout(pan, 500); // Start pan after a short delay
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            tooltip.style.left = `${event.clientX + 15}px`;
            tooltip.style.top = `${event.clientY + 15}px`;
        }
        
        function onClick(event) {
            if (isFocused) return;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects, true);

            if (intersects.length > 0) {
                const object = intersects[0].object;
                const data = object.userData;

                if (data.isSocial) {
                    window.open(data.url, '_blank');
                } else if (data.id) {
                    focusOnObject(object);
                }
            }
        }

        function setGlow(object, shouldGlow) {
            if (!object) return;
            object.traverse(child => {
                if (child.isMesh) {
                    child.material.emissive.set(shouldGlow ? 0xffffff : 0x000000);
                    child.material.emissiveIntensity = shouldGlow ? 0.3 : 1;
                }
            });
        }
        
        function focusOnObject(object) {
            const data = object.userData;
            if (!data || isFocused) return;
            isFocused = true;
            controls.enabled = false;
            
            returnState = {
                pos: camera.position.clone(),
                target: controls.target.clone()
            };
            
            const startPos = camera.position.clone();
            const endPos = data.targetPos;
            const startTarget = controls.target.clone();
            const endTarget = data.targetLookAt;

            let t = 0;
            const duration = 1200;
            const startTime = Date.now();
            
            function tween() {
                const elapsed = Date.now() - startTime;
                t = Math.min(1, elapsed / duration);
                const easedT = 1 - Math.pow(1 - t, 4); // easeOutQuart

                camera.position.lerpVectors(startPos, endPos, easedT);
                controls.target.lerpVectors(startTarget, endTarget, easedT);
                
                if (t < 1) {
                    requestAnimationFrame(tween);
                } else {
                    showInfoCard(data);
                }
            }
            tween();
        }

        function unfocus() {
            if (!isFocused) return;
            
            hideInfoCard();
            
            const startPos = camera.position.clone();
            const endPos = returnState.pos;
            const startTarget = controls.target.clone();
            const endTarget = returnState.target;

            let t = 0;
            const duration = 1200;
            const startTime = Date.now();
            
            function tweenBack() {
                const elapsed = Date.now() - startTime;
                t = Math.min(1, elapsed / duration);
                const easedT = 1 - Math.pow(1 - t, 4); // easeOutQuart

                camera.position.lerpVectors(startPos, endPos, easedT);
                controls.target.lerpVectors(startTarget, endTarget, easedT);
                
                if (t < 1) {
                    requestAnimationFrame(tweenBack);
                } else {
                    isFocused = false;
                    controls.enabled = true;
                }
            }
            tweenBack();
        }

        function showInfoCard(data) {
            document.getElementById('card-title').textContent = data.name;
            document.getElementById('card-description').textContent = data.description;
            
            const buttonsContainer = document.getElementById('card-buttons');
            const youtubeContainer = document.getElementById('youtube-player-container');
            const youtubePlayer = document.getElementById('youtube-player');
            buttonsContainer.innerHTML = '';
            youtubeContainer.style.display = 'none';

            data.links.forEach(link => {
                const button = document.createElement('a');
                button.className = 'card-button';
                
                if (link.url) button.href = link.url;
                
                if (link.action === 'youtube') {
                    button.onclick = (e) => {
                        e.preventDefault();
                        youtubePlayer.src = link.url;
                        youtubeContainer.style.display = 'block';
                    };
                } else {
                    button.target = '_blank';
                }
                
                let iconHtml = '';
                if(link.icon){
                  iconHtml = `<img src="${link.icon}" class="logo-icon" alt="${link.text} logo">`;
                }

                button.innerHTML = `${iconHtml}${link.text}`;
                buttonsContainer.appendChild(button);
            });
            
            modalOverlay.classList.add('visible');
        }

        function hideInfoCard() {
            modalOverlay.classList.remove('visible');
            const youtubePlayer = document.getElementById('youtube-player');
            // Stop video
            youtubePlayer.src = '';
        }

        function animate() {
            controls.update();
            
            // Raycasting for hover effect
            if (!isFocused) {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(interactiveObjects, true);

                if (intersects.length > 0) {
                    const intersected = intersects[0].object.userData.isSocial ? intersects[0].object : interactiveObjects.find(o => o.uuid === intersects[0].object.userData.uuid);

                    if (hoveredObject !== intersected) {
                        setGlow(hoveredObject, false);
                        hoveredObject = intersected;
                        setGlow(hoveredObject, true);

                        const displayName = hoveredObject.userData.isSocial ? 
                            'Open ' + hoveredObject.userData.id.charAt(0).toUpperCase() + hoveredObject.userData.id.slice(1) :
                             hoveredObject.userData.name;

                        tooltip.textContent = displayName;
                        tooltip.style.display = 'block';
                    }
                } else {
                    if (hoveredObject) {
                        setGlow(hoveredObject, false);
                        hoveredObject = null;
                        tooltip.style.display = 'none';
                    }
                }
            } else {
                 if (hoveredObject) {
                    setGlow(hoveredObject, false);
                    hoveredObject = null;
                    tooltip.style.display = 'none';
                 }
            }

            renderer.render(scene, camera);
        }

        // --- UI Scripts ---
        function startStopwatch() {
            const stopwatchEl = document.getElementById('stopwatch');
            const startDate = new Date('2025-07-15T01:14:24Z'); // Use ISO format for universal parsing
            
            setInterval(() => {
                const now = new Date();
                const diff = now - startDate;
                
                const hours = String(Math.floor(diff / 3600000)).padStart(2, '0');
                const minutes = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
                const seconds = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
                
                stopwatchEl.textContent = `${hours}:${minutes}:${seconds}`;
            }, 1000);
        }

        function startTypewriter() {
            const el = document.getElementById('subtitle-text');
            const text = "This portfolio is re-imagined and re-designed by an AI each day, so its form is ever-changing.";
            let i = 0;
            
            function type() {
                if (i < text.length) {
                    el.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 50);
                }
            }
            setTimeout(type, 3500); // Start after header fade
        }
        
        // --- Run ---
        init();
        startStopwatch();

    </script>
<!-- Add this block to embed the like button -->
    <script src="/static/js/like_button.js"></script>
    <script>
        LikeButton.init({
          pageId: "20250715",
          position: "bottom-right", // Options: bottom-right, bottom-left, top-right, top-left
        });
    </script>

</body>
</html>