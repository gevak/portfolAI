<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Geva Kipper – Intuitive Data Platforms</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Inter font from Google Fonts, weight range for modern effects -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      height: 100vh;
      min-height: 100vw;
      overflow: hidden;
      font-family: 'Inter', 'Poppins', 'Segoe UI', Arial, sans-serif;
      background: #161929;
      position: relative;
      color: #f7f8fa;
      /* Texture overlays for neural/fog effect */
    }
    /* SVG fog and "neural" canvas overlays */
    #bg-neural, #bg-fog {
      position: absolute;
      z-index: 0;
      left: 0; top: 0; width: 100vw; height: 100vh;
      pointer-events: none;
    }
    #bg-neural {
      opacity: 0.45;
      filter: blur(0.6px) brightness(1.08);
    }
    #bg-fog {
      opacity: 0.22;
      filter: blur(8px) brightness(0.97);
    }

    /* Central content layout */
    #center-content {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-54%);
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 3;
      width: 100vw;
      pointer-events: none;
    }
    #name-glow {
      font-size: clamp(2.7rem,6vw,5.7rem);
      font-weight: 800;
      color: #fff;
      letter-spacing: 0.01em;
      text-shadow: 0 0 24px #7ad6ff66, 0 0 8px #fff8, 0 1px 0 #1112, 0 0 2px #CAFFEF33;
      line-height: 1.03;
      filter: brightness(1.19) blur(0.1px);
      font-family: inherit;
      pointer-events: none;
      /* geometric, but Inter does this job */
    }
    #subtitle-italic {
      margin-top: 1.65rem;
      max-width: 38ch;
      font-style: italic;
      font-size: 1.45rem;
      font-weight: 500;
      color: #e0e1e9;
      letter-spacing: 0.01em;
      text-shadow: 0 3px 16px #1c2944cc;
      pointer-events: none;
      text-align: center;
    }
    #ai-morph {
      margin-top: 1.1em;
      font-size: 1.1rem;
      font-family: inherit;
      color: #9ae9ff;
      font-style: italic;
      letter-spacing: 0.02em;
      opacity: 1;
      text-align: center;
      transition: opacity 0.5s cubic-bezier(0.61,0.22,0.37,0.92);
      pointer-events: auto;
      background: linear-gradient(90deg,#79baff33 0%,#c45fff33 90%);
      background-clip:text;-webkit-background-clip:text;
      -webkit-text-fill-color: transparent;
      text-fill-color: transparent;
      filter: blur(0.1px) drop-shadow(0 2px 6px #146fff33);
      user-select: none;
      font-weight: 600;
    }
    #ai-morph.faded {
      opacity: 0.4;
    }

    /* Mind Map Layer */
    #mindmap-canvas {
      position: absolute;
      left: 0; top: 0; width: 100vw; height: 100vh;
      z-index: 2;
      /* pointer-events via script management */
    }
    /* Mind Map UI containers over canvas; enables interaction */
    #mindmap-ui {
      position: absolute;
      pointer-events: none;
      z-index: 5;
      left: 0; top: 0; width: 100vw; height: 100vh;
    }

    /* Cluster (node) styles */
    .cluster-node {
      position: absolute;
      border-radius: 1000px;
      backdrop-filter: blur(1.5px) saturate(1.2);
      box-shadow: 0 3px 24px 0px #01151c17,0 1.5px 12px #3ec8fc38;
      transition: 
        transform 0.40s cubic-bezier(0.7,0.9,0.2,1.07),
        filter 0.4s cubic-bezier(0.6,0.3,0.4,1.05),
        box-shadow 0.23s cubic-bezier(0.36,0.7,0.23,0.8),
        background 0.26s cubic-bezier(0.53,0.7,0.19,1.16);
      min-width: 84px;
      min-height: 84px;
      max-width: 180px;
      max-height: 180px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      cursor: pointer;
      opacity: 1;
      border: 2px solid #fff2;
      outline: none;
      user-select: none;
      will-change: transform, filter, background;
      z-index: 8;
    }
    .cluster-node.inactive {
      opacity: 0.22 !important;
      filter: blur(1px) grayscale(40%);
      pointer-events: none;
      transform: scale(0.93);
    }
    .cluster-node.focused {
      z-index: 50 !important;
      /* emphasize focus */
      box-shadow: 0 0 36px #98e6ff66, 0 0 2px #fff9, 0 3px 24px #4261bb33;
      filter: brightness(1.34) saturate(1.1);
      min-width: 112px;
      min-height: 112px;
      outline: 4px solid #fff2;
    }
    .cluster-node:hover:not(.focused):not(.inactive),
    .cluster-node:focus-visible:not(.focused):not(.inactive) {
      transform: scale(1.10) translateY(-7px);
      filter: brightness(1.24) saturate(1.25) drop-shadow(0 2px 10px #5ee6ff42);
      box-shadow: 0 2px 30px #fcfefe27, 0 2px 11px #94e9ff35;
      border-color: #fff5;
      outline: none;
      z-index: 13;
    }
    .cluster-icon-wrapper {
      width: 54px; height: 54px;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 0.6em;
      z-index: 2;
    }
    .cluster-title {
      font-size: 1.06rem;
      font-weight: 700;
      text-align: center;
      line-height: 1.13;
      color: #f8fdff;
      letter-spacing: 0.002em;
      filter: brightness(1.08);
      z-index: 2;
      text-shadow: 0 2px 8px #234ca803;
      pointer-events: none;
      user-select: none;
    }
    /* Each node gets its own accent background gradient */
    .cluster0 { background: radial-gradient(ellipse at 40% 60%,rgba(97,223,236,0.83) 0%,rgba(21,53,74,0.64) 84%); }
    .cluster1 { background: radial-gradient(ellipse at 40% 60%,rgba(98,163,239,0.83) 0%,rgba(21,53,74,0.67) 88%); }
    .cluster2 { background: radial-gradient(ellipse at 60% 56%,rgba(110,226,155,0.75) 0%,rgba(12,63,47,0.75) 95%); }
    .cluster3 { background: radial-gradient(ellipse at 30% 82%,rgba(210,115,253,0.77) 0%,rgba(21,33,77,0.66) 88%); }
    .cluster4 { background: radial-gradient(ellipse at 54% 28%,rgba(138,210,255,0.77) 0%,rgba(31,62,94,0.66) 86%); }

    .cluster-node:not(.focused):active {
      transform: scale(1.04);
    }
    .cluster-node:focus-visible {
      outline: 2.5px solid #fff5;
    }
    /* Hide nodes on mobile if not focused (upon zoom) */
    @media (max-width:580px) {
      .cluster-node {
        min-width: 74px !important;
        min-height: 74px !important;
        font-size: 0.95em;
      }
    }

    /* Animated mind map lines (drawn in canvas, not styled here) */

    /* Cluster Zoom Modal/Box */
    #cluster-modal-bg {
      position: fixed;
      inset: 0;
      z-index: 40;
      display: none;
      background: rgba(16,22,31,0.38);
      backdrop-filter: blur(5.4px) saturate(1.4) brightness(1.05);
      pointer-events: none;
      transition: background 0.55s cubic-bezier(0.48,0.58,0.23,1.14);
    }
    #cluster-modal-bg.active {
      display: block;
      pointer-events: auto;
      animation: clusterfadein 0.59s cubic-bezier(0.65,0.38,0.33,1.04);
    }
    @keyframes clusterfadein { 0% {opacity: 0;} to {opacity: 1;}}

    #cluster-modal-box {
      position: fixed;
      left: 50%;
      top: 50%;
      z-index: 98;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(0.76);
      transition: 
        box-shadow 0.27s,
        backdrop-filter 0.4s,
        transform 0.54s cubic-bezier(.27,.98,.39,1.04),
        min-width 0.24s,
        min-height 0.23s;
      min-width: 320px;
      min-height: 170px;
      max-width: 96vw;
      max-height: 98vh;
      border-radius: 30px;
      overflow: visible;
      opacity: 0;
      background: rgba(27,39,56,0.74);
      box-shadow: 0 7px 60px 0px #96e8ff55, 0 1.2px 22px #9100ff37;
      backdrop-filter: blur(20px) saturate(1.4);
      border: 1.7px solid #74d4ff35;
      display: flex;
      flex-direction: row;
      gap: 0;
      align-items: stretch;
      /* glassmorphism/parallax via script & background below (see .parallax-bg) */
      transition-property: opacity, transform, box-shadow, min-width, min-height, backdrop-filter;
      transition-duration: 0.66s, 0.53s, 0.28s, 0.24s, 0.22s, 0.24s;
      pointer-events: auto;
      z-index: 99;
      will-change: transform, opacity, filter;
      visibility: hidden;
    }
    #cluster-modal-box.active {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.0);
      visibility: visible;
      animation: clusterModalExpand 0.51s cubic-bezier(.19,.98,.49,1.04);
    }
    @keyframes clusterModalExpand {
      0% { opacity:0; transform:translate(-50%,-51%) scale(0.7);}
      84% { opacity:1; transform:translate(-50%,-51%) scale(1.09);}
      100%{ opacity:1; transform:translate(-50%,-50%) scale(1);}
    }
    .modal-close-btn {
      position: absolute;
      top: 16px; right: 20px;
      width: 32px; height: 32px;
      background: rgba(19,35,63,0.16);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: #fff;
      font-size: 1.5em;
      border: none;
      cursor: pointer;
      z-index: 120;
      transition: background 0.14s;
      box-shadow: 0 0 7px #9ed7ff72;
      opacity: 0.8;
      pointer-events: auto;
    }
    .modal-close-btn:hover {
      background: #9eefff33;
      color: #1e2745;
      opacity: 1;
    }
    /* glass/parallax background for the modal */
    .parallax-bg {
      position: absolute;
      left: 0; top: 0; 
      width: 100%; height: 100%;
      z-index: 1;
      border-radius: inherit;
      overflow: hidden;
      pointer-events: none;
      filter: blur(8.5px) saturate(1.2) contrast(1.2) brightness(1.10);
      background: radial-gradient(ellipse 80% 48% at 60% 52%,#7ac9fe29 10%,#a07cff20 68%, transparent 100%);
      opacity: 0.8;
    }

    /* Project cards inside the modal */
    .cluster-modal-content {
      position: relative;
      z-index: 8;
      display: flex;
      flex-direction: row;
      align-items: stretch;
      width: 100%;
      min-height: 270px;
    }
    .cmc-col {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .cmc-stretch { flex: 1 1 0; }
    .cmc-shrink { flex: 0 0 auto; }
    .cmc-center { align-items: center; }
    .cmc-middle { justify-content: center; }
    .cmc-pad { padding: 32px 22px;}
    /* For cards with left, center, right sections */
    .cluster-modal-main {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 0px;
      width: 100%;
      min-height: 260px;
      background: none;
    }
    /* For mobile: */
    @media (max-width:670px) {
      #cluster-modal-box {
        min-width: unset; min-height: unset; width: 98vw !important; max-width: unset;
        padding: 4px;
        border-radius: 17px;
      }
      .cluster-modal-content, .cluster-modal-main {
        flex-direction: column;
      }
      .cmc-pad { padding: 20px 8px;}
    }

    /* Card common details */
    .cmc-title {
      font-size: 1.22em;
      font-weight: 700;
      text-shadow: 0 2px 12px #429cff2e;
      margin-bottom: 1.3em;
      letter-spacing: 0.01em;
    }
    .cmc-desc {
      font-size: 1.07em;
      font-style: italic;
      color: #def3fa;
      filter: brightness(1.03) saturate(1.13);
      margin-bottom: 0.5em;
      letter-spacing: 0.001em;
    }
    .cmc-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5ch;
      padding: 7.5px 21px;
      background: linear-gradient(94deg,#34bfe8 8%, #00ffdf 90%);
      color: #162a3f;
      border-radius: 30px;
      text-decoration: none;
      font-weight: 700;
      letter-spacing: 0.03em;
      font-size: 1.04em;
      box-shadow: 0 2px 14px #5cfefe28;
      transition: background 0.16s, color 0.17s;
      margin-right: 1em;
      white-space: nowrap;
      border: none;
      cursor: pointer;
      user-select: none;
    }
    .cmc-link:hover {
      background: linear-gradient(90deg,#34bfe8 17%, #e3f0ff 95%);
      color: #15425b;
    }
    /* Video Preview thumb */
    .cmc-video-preview {
      border-radius: 18px;
      overflow: hidden;
      width: 140px; height: 87px;
      box-shadow: 0 6px 18px #4661ac45;
      border: 2.5px solid #e0ebfa18;
      position: relative;
      background: #191d24;
      cursor: pointer;
      transition: box-shadow 0.13s, border-color 0.18s;
      margin-top: 12px;
      margin-bottom: 6px;
    }
    .cmc-video-preview:hover {
      box-shadow: 0 4px 31px #4baaff65;
      border-color: #92f6ff65;
    }
    .cmc-video-preview .play-overlay {
      position: absolute;
      z-index: 3;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%);
      width: 42px; height: 42px;
      background: rgba(61,140,252,0.6);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 2.3em; color: #fff;
      transition: background 0.2s;
      box-shadow: 0 2px 10px #63e8ffcc;
    }
    .cmc-video-preview:hover .play-overlay {
      background: #fff;
      color: #224a75;
    }

    /* Minimal waveform for GlglStats */
    .waveform-bg {
      position: relative;
      width: 126px; height: 96px;
      background: #23476a;
      border-radius: 18px;
      margin-right: 18px;
      margin-top: 9px;
      overflow: hidden;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 1px 12px #94e1fd35;
      border: 2.5px solid #21315d47;
      padding: 0;
    }

    /* Ahuzat-Dibuk map preview */
    .mini-map {
      position: relative;
      width: 132px; height: 86px;
      border-radius: 15px;
      overflow: hidden;
      margin-right: 18px;
      margin-top: 8px;
      background: #23293c;
      box-shadow: 0 1.5px 9px #53bffd35;
      border: 2.5px solid #19395339;
      pointer-events: none;
      background-size: cover;
      background-position: center;
    }
    .heat-fade {
      position: absolute;
      inset: 0;
      border-radius: 15px;
      background: radial-gradient(ellipse 66% 73% at 60% 32%,#8be6fd88 21%,#ffd33333 60%,#0a83ff00 100%);
      opacity: 0.43;
      pointer-events: none;
    }
    .mini-map-fade-border {
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: radial-gradient(circle,transparent 53%, #23293c 94%);
      pointer-events: none;
      z-index: 5;
    }

    /* Inline news icons */
    .news-links {
      display: flex;
      flex-direction: row;
      gap: 0.6em;
      margin: 0.7em 0 0em 0;
      align-items: center;
    }
    .news-icon-link {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: #fff3;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.12s, transform 0.13s;
      color: #fff;
      box-shadow: 0 2px 8px #59e8fc10;
      text-decoration: none;
      font-size: 1.12em;
    }
    .news-icon-link:hover, .news-icon-link:focus {
      background: #c9feffcc;
      color: #23476a;
      transform: scale(1.12);
      box-shadow: 0 3px 15px #4de6ff56;
    }
    .fb-link {
      display: inline-flex; align-items: center; gap: 0.31em;
      color: #4088ff;
      text-decoration: none;
      font-size: 1.05em;
      font-weight: 600;
      margin-top: 0.8em;
      margin-bottom: 0.1em;
      transition: color 0.16s;
    }
    .fb-link:hover {
      color: #fff;
      text-decoration: underline;
    }
    .fb-icon {
      width: 1.22em; height: 1.22em;
      display: inline-block;
      vertical-align: middle;
      margin-right: 0.2em;
      filter: brightness(2) blur(0.1px);
    }

    /* SVG mesh background (2D Part Orienting) */
    .svg-mesh-bg {
      width: 110px; height: 110px;
      background: #233d2d;
      border-radius: 16px;
      margin-right: 20px;
      margin-top: 10px;
      overflow: hidden;
      border: 2.5px solid #183d2357;
      padding: 8px 0;
      pointer-events: none;
    }
    .proj-arrow-link {
      margin-left: 8px;
      margin-top: 1em;
      font-size: 1.8em;
      color: #89e6f5;
      background: none;
      border: none;
      outline: none;
      display: inline-block;
      border-radius: 99px;
      padding: 7px;
      transition: color 0.16s, background 0.16s;
      cursor: pointer;
    }
    .proj-arrow-link:hover {
      background: #bffbfd;
      color: #193a5a;
    }
    /* Portfolio meta preview */
    .portfolio-mini-window {
      margin-right: 18px;
      width: 92px; height: 93px;
      background: linear-gradient(140deg,#3063ae 24%,#bd73fb 80%);
      border-radius: 11px;
      overflow: hidden;
      box-shadow: 0 1.5px 18px #41219d25;
      border: 2.5px solid #2f33634b;
      opacity: 0.88;
      display: flex; align-items: center; justify-content: center;
      position: relative;
    }
    .portfolio-mini-mindmap {
      width: 62px;
      height: 62px;
      opacity: 0.93;
      filter: blur(0.1px) brightness(1.10);
    }
    .meta-desc {
      font-size: 1.02em;
      font-weight: 500;
      color: #f0e3ff;
      margin-bottom: 0.4em;
    }
    .meta-link {
      color: #aabaff;
      background: #21154b44;
      padding: 5px 12px;
      border-radius: 10px;
      font-size: 0.98em;
      text-decoration: none;
      margin-top:0.21em; display: inline-block;
      transition: background .17s, color .15s;
    }
    .meta-link:hover {
      background: #e1eaff;
      color: #181f29;
    }

    /* Contact cluster styles */
    .contact-card {
      min-width: 180px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 20px;
      margin-left: 16px;
      margin-top: 18px;
    }
    .contact-row {
      display: flex;
      gap: 1.25em;
    }
    .contact-btn {
      display: flex; align-items: center;
      justify-content: flex-start;
      gap: 0.4em;
      padding: 12px 22px;
      background: rgba(17,21,32,0.11);
      border: 1.5px solid #eefefc11;
      border-radius: 30px;
      font-size: 1em;
      font-weight: 600;
      color: #e2f3fb;
      outline: none;
      transition: background 0.15s, color 0.14s, border-color .17s, box-shadow .13s;
      cursor: pointer;
      margin-right: 0.1em;
      box-shadow: 0 2px 10px #aadfff18;
      text-decoration: none;
    }
    .contact-btn:hover, .contact-btn:focus {
      background: #ccf2ff;
      color: #1e3882;
      border-color: #abfbff;
      box-shadow: 0 5px 28px #36e6ffa6;
      filter: brightness(1.18);
    }

    .pulse-bg {
      position: absolute;
      left: -16%; top: -20%;
      width: 170%; height: 150%;
      background: radial-gradient(circle at 54% 54%,rgba(80,213,250,0.51) 8%,rgba(150,180,255,0.14) 60%,transparent 100%);
      filter: blur(41px);
      opacity: .54;
      pointer-events: none;
      animation: bgpulseanm 3.8s ease-in-out infinite alternate;
      z-index: 0;
    }
    @keyframes bgpulseanm {
      0% { opacity: 0.4;}
      53%{ opacity: 0.56;}
      62% { opacity: 0.62;}
      100%{ opacity: 0.45;}
    }

    /* Stopwatch and credits */
    .corner-ui {
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      width: 100vw;
      pointer-events: none;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding:  0 2vw 16px 2vw;
    }
    .corner-cred {
      color: #e3f4fbab;
      letter-spacing: 0.01em;
      font-size: 1.03em;
      font-style: italic;
      font-family: inherit;
      pointer-events: auto;
      user-select: text;
      filter: drop-shadow(0 2.5px 9px #23446e77) blur(0.1px);
      text-shadow: 0 1.5px 8px #44508035;
    }
    .corner-stopwatch {
      color: #bbdbfd;
      font-family: 'Inter', 'Poppins', monospace;
      font-weight: 900;
      font-size: 1.25em;
      letter-spacing: 0.014em;
      text-shadow: 0 1.5px 12px #83f6fc65;
      filter: blur(0.1px) brightness(1.34);
      background: linear-gradient(90deg,#53bcff33,#bf7cff58);
      background-clip: text; -webkit-background-clip:text; -webkit-text-fill-color: transparent; text-fill-color: transparent;
      border-radius: 9px;
      pointer-events: auto;
      user-select: text;
      padding: 1.5px 13px 2px 10px;
    }

    /* Misc/scrollbars */
    ::selection {
      background: #1ddffc;
      color: #181d22;
    }
    ::-webkit-scrollbar {width:8px;}
    ::-webkit-scrollbar-thumb {background:#3088ee19;}

    @media (max-width: 600px) {
      .corner-ui {
        padding: 0 2vw 7.5px 2vw;
        font-size: 0.95em;
      }
    }
  </style>
</head>
<body>
  <!-- Neural "connections" SVG background overlay: generated via script -->
  <svg id="bg-neural"></svg>
  <!-- Foggy noise/curl overlay, with animated movement -->
  <canvas id="bg-fog"></canvas>
  
  <!-- Central hero content -->
  <div id="center-content">
    <div id="name-glow">Geva Kipper</div>
    <div id="subtitle-italic">Currently building intuitive data platforms at Google, using ML to turn real-world signals into insights.</div>
    <div id="ai-morph"></div>
  </div>
  
  <!-- Mind map drawing canvas -->
  <canvas id="mindmap-canvas" width="1920" height="1080"></canvas>
  <!-- Node UI overlay for cluster nodes (positions controlled by JS) -->
  <div id="mindmap-ui"></div>
  
  <!-- Cluster modal zoom box + BG -->
  <div id="cluster-modal-bg"></div>
  <div id="cluster-modal-box" tabindex="-1" aria-modal="true" aria-hidden="true"></div>
  
  <!-- Subtle corner UI: credits & stopwatch -->
  <div class="corner-ui">
    <div class="corner-cred">
      Designed and generated by OpenAI’s GPT-4, inspired by Geva’s daily flux.
    </div>
    <div class="corner-stopwatch" id="corner-stopwatch"></div>
  </div>

  <!-- Sound FX (muted by default, loaded lazily) -->
  <audio id="sfx-pop" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/377/377-preview.mp3" muted></audio>
  <audio id="sfx-swip" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/1079/1079-preview.mp3" muted></audio>
  <audio id="sfx-note" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/3025/3025-preview.mp3" muted></audio>

<script>
/* --- Responsive Layout/Node Positions --- */
const CLUSTERS = [
  {
    key: 'glgl',
    title: 'GlglStats',
    color: '#49e6ff',
    accent: 'cluster0',
    icon: 'glgl',
    subdesc: 'pop repetitiveness → sound',
    sound: 'note',
  },
  {
    key: 'ahuzat',
    title: 'Ahuzat Dibuk',
    color: '#5f98ff',
    accent: 'cluster1',
    icon: 'parking',
    subdesc: 'real-time parking',
    sound: 'pop',
  },
  {
    key: 'orient',
    title: '2D Part Orienting',
    color: '#34ffb3',
    accent: 'cluster2',
    icon: 'orient',
    subdesc: 'geometry',
    sound: 'swip',
  },
  {
    key: 'portfolio',
    title: 'Portfolio Site (meta!)',
    color: '#e793ff',
    accent: 'cluster3',
    icon: 'meta',
    subdesc: 'site meta',
    sound: 'swip',
  },
  {
    key: 'contact',
    title: 'Contact',
    color: '#71c9fb',
    accent: 'cluster4',
    icon: 'contact',
    subdesc: 'connect',
    sound: 'pop',
  }
];
let clusterPositions = [];
let screenMode = 'desktop'; // or 'mobile'

/* --- Typewriter / dissolve subtitle effect --- */
const morphStrings = [
  "This portfolio is redesigned daily by AI—it’s never the same twice.",
  "A different mind map. Every visit. Powered by AI and creative chance.",
  "AI varies this portfolio with new shapes, lines, and accents each day.",
  "No two days, no two layouts. Welcome to AI's living portfolio design."
];
function randomMorphString() {
  if(Math.random() < 0.54) return morphStrings[0];
  let idx = Math.floor(Math.random()*morphStrings.length);
  return morphStrings[idx];
}
function morphSubtitle() {
  let str = randomMorphString();
  const el = document.getElementById('ai-morph');
  let prev = el.textContent;
  if(!prev) {
    typewriter(el, str, 0,20,1);
    return;
  }
  dissolveText(prev,str,el);
}

function typewriter(el, text, i=0, delay=18,step=1) {
  let show = "";
  if(i>0) show = text.slice(0,i);
  el.textContent = show+"|";
  if(i < text.length) {
    setTimeout(()=>typewriter(el,text,i+step,delay,step),delay+Math.random()*10);
  } else {
    el.textContent = text;
  }
}
function dissolveText(prev, next, el) {
  el.style.opacity = "0.3";
  setTimeout(() => {
    el.textContent = next;
    el.style.opacity = "1";
  }, 350);
}
setTimeout(morphSubtitle,666);
setInterval(morphSubtitle,16_000);

let aiMorphUsed = false;
const aiMorphEl = document.getElementById('ai-morph');
function fadeMorphSubtitle() {
  if(!aiMorphUsed) {
    aiMorphEl.classList.add('faded');
    aiMorphUsed=true;
  }
}
['pointermove','click','keydown','touchstart'].forEach(evt=>window.addEventListener(evt, fadeMorphSubtitle, {once:true}));

/* --- Neural SVG background --- */
function drawNeuralBG() {
  const svg = document.getElementById('bg-neural');
  const w = window.innerWidth, h = window.innerHeight;
  svg.setAttribute('width',w);
  svg.setAttribute('height',h);
  let N = Math.round(w*h/12000);
  N = Math.max(7,N);
  let points = [];
  for(let i=0;i<N;i++){
    const angle = Math.random()*2*Math.PI;
    const r = Math.sqrt(Math.random())*0.38*Math.min(w,h);
    let x = w/2 + Math.cos(angle)*r + (Math.random()-0.5)*w/7.5;
    let y = h/2 + Math.sin(angle)*r + (Math.random()-0.5)*h/6.5;
    points.push([x,y]);
  }
  let lines = '';
  for(let i=0;i<N;i++){
    let c = i==0? "#85e6ff44" : "#48dcffa8";
    for(let j=i+1;j<N;j++){
      let d=Math.hypot(points[i][0]-points[j][0],points[i][1]-points[j][1]);
      if(d<(w/6.4)) {
        const opacity = Math.max(0,0.36-Math.random()*0.21-d/w/2)*1.28;
        lines += `<line x1="${points[i][0].toFixed(0)}" y1="${points[i][1].toFixed(0)}" x2="${points[j][0].toFixed(0)}" y2="${points[j][1].toFixed(0)}" stroke="url(#lg${i})" stroke-width="${1.7-Math.random()}" opacity="${opacity}" />`;
      }
    }
  }
  let defs='';
  for(let i=0;i<N;i++){
    defs+=`<linearGradient id="lg${i}" x1="0%" y1="0%" x2="80%" y2="80%">
      <stop stop-color="#92ebff" stop-opacity="0.34" />
      <stop offset="100%" stop-color="#b9afee" stop-opacity="0.17"/>
    </linearGradient>`;
  }
  let dots = points.map(p=>`<circle cx="${p[0].toFixed(0)}" cy="${p[1].toFixed(0)}" r="${Math.random()*2+1.7}" fill="#96e6fe88" opacity="0.09"/>`).join('');
  svg.innerHTML =
    `<defs>${defs}</defs><g>${lines}</g><g>${dots}</g>`;
}
window.addEventListener('resize', drawNeuralBG);
drawNeuralBG();

/* --- Moving fog overlay --- */
const fogCanvas = document.getElementById('bg-fog');
let fogPhase = Math.random()*10000;
function drawFog() {
  const ctx = fogCanvas.getContext('2d');
  fogCanvas.width = window.innerWidth;
  fogCanvas.height= window.innerHeight;
  // Simple layered perlin-like noisey fog
  ctx.clearRect(0,0,fogCanvas.width,fogCanvas.height);
  for(let k=0;k<2;k++) {
    for(let i=0;i<76;i++) {
      let x = ((i*9979 + fogPhase*0.0173*k)%fogCanvas.width)*1.09;
      let y = ((i*i*67 + fogPhase*0.077*k)%fogCanvas.height)*1.17;
      let r = 90+Math.sin(i*.41+fogPhase*0.15+k)*80,kp=0.14+k*0.11;
      ctx.globalAlpha=0.085*(.99-Math.abs(Math.sin(i+fogPhase*0.017-0.13*k)*0.27));
      let grad=ctx.createRadialGradient(x+r*kp,y+r*kp,r/5,x,y,r);
      grad.addColorStop(0,k? "#5187aad0" : "#b8fbfc88");
      grad.addColorStop(k?0.4:0.5,k?"#141b39cc":"#ffd9ff44");
      grad.addColorStop(1,"#18293200");
      ctx.beginPath(); ctx.arc(x,y,r,0,2*Math.PI); ctx.closePath();
      ctx.fillStyle=grad;
      ctx.fill();
    }
  }
}
function animateFog() {
  fogPhase += 0.18+Math.sin(fogPhase/300)*0.21;
  drawFog();
  requestAnimationFrame(animateFog);
}
window.addEventListener('resize', drawFog);
animateFog();

/* --- Mind Map Layout & Animation --- */
const mindmapCanvas = document.getElementById('mindmap-canvas');
const mindmapUI = document.getElementById('mindmap-ui');
let mmW = window.innerWidth, mmH = window.innerHeight;
function mindmapScreenMode() {
  return window.innerWidth<=670? 'mobile' : 'desktop';
}
function clusterOrbitPositions(centerX,centerY,orbitR,angleSpread) {
  // Returns {x,y} of five clusters, asymmetric but visually pleasing
  // Slight random flux ("daily flux") via seeded randomness
  let d = new Date();
  let daySeed = (d.getDate()+d.getYear()+d.getMonth()*31)%379 + Math.floor(Date.now()/8.64e7);
  function rand() { return Math.abs(Math.sin(daySeed*0.131+centerX*0.003+centerY*0.019));}
  let baseAng = Math.PI/2 + rand()*0.24;      // topmost angle
  angleSpread += rand()*0.044;
  let res = [];
  for(let i=0; i<CLUSTERS.length; i++) {
    let theta = baseAng + (i-2)*angleSpread + Math.sin(i+rand()*10.11)*0.15*Math.min(1, orbitR/420);
    // organic staggering:
    let modR = orbitR * (0.95 + (i==2? 0.06 : 0.00) + (i==4?0.10:0));
    let dx = modR*Math.cos(theta);
    let dy = modR*Math.sin(theta);
    // Drift (daily), organic irregular (left/right, up tiny)
    dx += Math.sin(daySeed*47.21 + i*3.11)*16 + (i==1?14:0)-(i==3?14:0);
    dy += Math.cos(daySeed*29.07 + i*1.13)*9  + (i==4?-13:0)+(i==0?-9:0);
    res.push({x: centerX+dx, y: centerY+dy});
  }
  return res;
}
function clusterVerticalPositions(centerX,topY,spacing) {
  // For mobile: nodes stack vertically
  let res = [];
  let baseY = topY;
  for(let i=0;i<CLUSTERS.length;i++) {
    let dx=0,dy=0;
    // Offset for some asymmetry
    dx = ((i==2)? 30 : (i==4? -12 : (i==1?7:0)));
    dy = baseY + i*spacing + (i==3?10:0)+(i==1?-7:0);
    res.push({x:centerX+dx,y:dy});
  }
  return res;
}
// Adaptive node position by screen mode; called on resize/zoom as well.
function updateClusterPositions() {
  mmW = window.innerWidth; mmH = window.innerHeight;
  if(mindmapScreenMode()==='desktop') {
    screenMode='desktop';
    let R = Math.min(mmW, mmH)+220;
    R = Math.max(220,Math.min(R,Math.min(mmH,mmW-65)-250))/2;
    let angSpread = Math.PI/7.6 + (Math.random()-0.5)*0.04;
    clusterPositions = clusterOrbitPositions(mmW/2, mmH/2-30, R, angSpread);
  } else {
    screenMode='mobile';
    let spacing = mmH/7.1;
    let ty = Math.max(130, mmH/6);
    clusterPositions = clusterVerticalPositions(mmW*0.5, ty, spacing);
  }
}
window.addEventListener('resize', ()=>{
  updateClusterPositions();
  positionClusterNodes();
  renderMindMapLines();
});
updateClusterPositions();

/* --- Mind Map Nodes (Cluster UI Elements) --- */
function createClusterNodes() {
  mindmapUI.innerHTML = '';
  for(let i=0;i<CLUSTERS.length;i++) {
    const c=CLUSTERS[i];
    let node=document.createElement('div');
    node.className = `cluster-node ${c.accent} clusteridx${i}`;
    node.setAttribute('tabindex', '0');
    node.setAttribute('role','button');
    node.setAttribute('aria-label', c.title);
    node.setAttribute('data-idx', i);
    node.innerHTML = `<div class="cluster-icon-wrapper" id="icon-for-node${i}"></div>
      <div class="cluster-title">${c.title}</div>`;
    mindmapUI.appendChild(node);
    node.addEventListener('pointerenter', ()=>setHoveredNode(i));
    node.addEventListener('focus', ()=>setHoveredNode(i));
    node.addEventListener('pointerleave', ()=>setHoveredNode(null));
    node.addEventListener('blur', ()=>setHoveredNode(null));
    node.addEventListener('click', ()=>zoomCluster(i));
    node.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'||e.key===' '){e.preventDefault(); zoomCluster(i);}
    });
  }
}
function renderClusterIcons() {
  // Produce SVGs, possibly animated, for each cluster node
  for(let i=0;i<CLUSTERS.length;i++) {
    const c=CLUSTERS[i];
    const cbg = c.color;
    let el = document.getElementById('icon-for-node'+i);
    let html = '';
    switch (c.icon) {
      case 'glgl':
        html = `<svg width="46" height="46" viewBox="0 0 48 48">
          <g>
            <ellipse id="noteA" cx="17" cy="27.5" rx="7.2" ry="7" fill="#7ce7ee" stroke="#fff" stroke-width="1.8" opacity="0.83"/>
            <ellipse id="noteB" cx="30.8" cy="20.5" rx="7.2" ry="7" fill="#8a9cff" stroke="#fff" stroke-width="1.8" opacity="0.64"/>
            <rect x="19.8" y="14" width="3.3" height="12.5" rx="1.3" fill="#ddefff" opacity="0.84" transform="rotate(-16 22 20.25)"/>
            <rect x="29" y="9.6" width="2.9" height="10.4" rx="1.3" fill="#d7bee6" opacity="0.88" transform="rotate(11 30.5 14.8)"/>
            <path id="linkB" d="M24 18 Q24.9 19.2 28.8 20.5" stroke="#befff7" stroke-width="2.1" fill="none" opacity="0.5"/>
          </g>
        </svg>`;
        break;
      case 'parking':
        html = `<svg width="45" height="45" viewBox="0 0 45 45">
          <defs>
            <radialGradient id="heat1" cx="50%" cy="48%" r="60%">
              <stop offset="0%" stop-color="#f7e667" stop-opacity="0.64"/>
              <stop offset="45%" stop-color="#ff9f29" stop-opacity="0.39" />
              <stop offset="72%" stop-color="#23e7fc" stop-opacity="0.14"/>
              <stop offset="100%" stop-color="#4a94ff" stop-opacity="0.04" />
            </radialGradient>
          </defs>
          <g>
            <circle cx="23" cy="26" r="18" fill="url(#heat1)" opacity="0.73"/>
            <circle cx="23" cy="26" r="10" fill="none" stroke="#eeda5a" stroke-width="3.7" opacity="0.42"/>
            <circle cx="23" cy="26" r="7" fill="#2a315d" stroke="#fff" stroke-width="2.1"/>
            <g>
              <ellipse cx="23" cy="17.8" rx="6.9" ry="6.9" fill="#78adee" stroke="#eaffff" stroke-width="2" opacity="0.91"/>
              <rect x="20.5" y="10" width="5" height="12" rx="2.4" fill="#defefd" opacity="0.55"/>
            </g>
          </g>
        </svg>`;
        break;
      case 'orient':
        html = `<svg width="46" height="46" viewBox="0 0 48 48">
          <g transform="translate(24,24)" id="rotPolyG${i}">
            <polygon points="-13,-6 0,-18 13,-6 8,11 -8,11"
              fill="#72ffd5" stroke="#fff" stroke-width="1.7" opacity="0.78"/>
            <g id="arrows${i}">
              <polygon points="0,-19 3,-14 -3,-14" fill="#fff" opacity="0.93"/>
              <polygon points="-15,-7 -10,-10 -12,-4" fill="#d0fcf9" opacity="0.7"/>
              <polygon points="15,-7 10,-11 13,-4" fill="#d0fcf9" opacity="0.65"/>
              <polygon points="0,14 3,18 -3,18" fill="#e9aaff" opacity="0.69"/>
            </g>
          </g>
        </svg>`;
        break;
      case 'meta':
        html = `<svg width="46" height="46" viewBox="0 0 48 48">
          <g>
            <rect x="12" y="11" width="24" height="26" rx="10" fill="#a472fa" opacity="0.84"/>
            <g>
              <rect x="17" y="18" width="14" height="10" rx="5" fill="#37e4ed" opacity="0.55"/>
              <ellipse cx="24" cy="23" rx="12" ry="7" fill="none" stroke="#fff" stroke-width="2.5" opacity="0.33"/>
              <path d="M19 30 Q25 38 29 30" stroke="#fff6" stroke-width="1.4" fill="none"/>
              <ellipse cx="24" cy="28" rx="6.2" ry="1.4" fill="#ad4cef" opacity="0.36"/>
            </g>
            <g>
              <path d="M11 21 Q24 9 37 21" stroke="#fff" stroke-width="2.4" fill="none" opacity="0.51"/>
              <circle cx="24" cy="11.2" r="1.9" fill="#fff" opacity="0.92"/>
            </g>
          </g>
        </svg>`;
        break;
      case 'contact':
        html = `<svg width="46" height="46" viewBox="0 0 46 46"><g>
          <circle cx="23" cy="13" r="6" fill="#f6fcff" stroke="#7fdafe" stroke-width="1.7"/>
          <circle cx="13.8" cy="30" r="5" fill="#98eaff" stroke="#fff" stroke-width="1.4"/>
          <circle cx="32.4" cy="32" r="5.5" fill="#9f8fff" stroke="#fff" stroke-width="1.4"/>
          <path d="M24 17 C15 22 18 27 13.8 30" stroke="#aacffb" stroke-width="1.7" fill="none"/>
          <path d="M23 18 Q27 21 32.4 32" stroke="#b1d2fa" stroke-width="1.7" fill="none"/>
        </g></svg>`;
        break;
      default: html = '';
    }
    el.innerHTML = html;
  }
}
function animateNodeIcons(ts) {
  // Animate music notes (GlglStats), polygon rotation (Orient), infinity ripple (Meta)
  const t = (performance.now()%8000)/1000;
  // GlglStats
  let noteA = document.getElementById('icon-for-node0')?.querySelector('#noteA');
  let noteB = document.getElementById('icon-for-node0')?.querySelector('#noteB');
  if(noteA && noteB) {
    noteA.setAttribute('cy', 27.5+ Math.sin(t*2.1)*2.1 );
    noteB.setAttribute('cy', 20.5+ Math.cos(t*1.56)*1.6 );
    noteA.setAttribute('rx', 7.2+Math.sin(t*1.3)*0.7);
    noteB.setAttribute('rx', 7.2+Math.cos(t*1.8)*0.7);
    let lb = document.getElementById('icon-for-node0')?.querySelector('#linkB');
    if(lb) lb.setAttribute('opacity', (0.44+Math.sin(t*1.1)*0.09).toFixed(2));
  }
  // Orient polygon
  let rotg = document.getElementById('icon-for-node2')?.querySelector(`#rotPolyG2`);
  if(rotg) {
    let deg = Math.sin(t*1.02+0.2)*21 + t*32;
    rotg.setAttribute('transform', `translate(24,24) rotate(${deg})`);
  }
  // Ripple infinity-paperclip (meta)
  let metaEl = document.getElementById('icon-for-node3');
  if(metaEl) {
    let svg = metaEl.querySelector('svg');
    if(svg)
      svg.style.filter = `drop-shadow(0 1px 9px #bb64ff99) brightness(${1.02+Math.sin(t*2.09)*0.07})`;
    let b = 0.84+Math.sin(t*2.77)*0.06;
    svg && (svg.style.opacity = b);
  }
  // Contact: gently pulsate circles
  let csvg = document.getElementById('icon-for-node4')?.querySelector('svg');
  if(csvg) {
    let d = (Math.sin(t*1.4)-0.02)*2;
    csvg.querySelectorAll('circle').forEach((el,i)=>{
      let baseR=[6,5,5.5][i]; el.setAttribute('r', baseR+Math.sin(t*2.3+i)*0.7+d*0.2);
    });
  }
  
  requestAnimationFrame(animateNodeIcons);
}
createClusterNodes();
renderClusterIcons();
animateNodeIcons();

function positionClusterNodes() {
  const nodes = mindmapUI.querySelectorAll('.cluster-node');
  for(let i=0;i<nodes.length;i++) {
    const pos = clusterPositions[i];
    if(screenMode==='desktop') {
      nodes[i].style.left = (pos.x-75)+"px";
      nodes[i].style.top  = (pos.y-75)+"px";
    } else {
      nodes[i].style.left = (pos.x-45)+"px";
      nodes[i].style.top  = (pos.y-45)+"px";
    }
  }
}
positionClusterNodes();

/* --- Mind Map Animated Lines --- */
let mindmapAnimPhase = 0;
function renderMindMapLines() {
  // Draw lines between center (Geva) and all clusters + interconnects
  const ctx = mindmapCanvas.getContext('2d');
  mindmapCanvas.width = window.innerWidth;
  mindmapCanvas.height= window.innerHeight;
  // Center of mind map (central Geva)
  let cx = window.innerWidth/2, cy = window.innerHeight/2-30;
  let pulse = 0.23+Math.sin(mindmapAnimPhase*1.9)*0.15 + Math.cos(Date.now()/1000)*0.14;

  // configuration for the lines' organic effect
  let nodeR = screenMode==='desktop'? 57:37;
  for(let i=0;i<clusterPositions.length;i++) {
    let pos=clusterPositions[i];
    // Only draw visible clusters if modal
    if(clusterModalState.active && clusterModalState.focusIdx!==i) continue;
    // Main connection line (to center)
    ctx.save();
    ctx.globalAlpha = 0.58+0.19*Math.sin(Date.now()/800+i*0.4);
    ctx.lineWidth = 3.7 + (Math.sin(mindmapAnimPhase*0.9+i+1)*1.04);
    let baseColor = CLUSTERS[i].color;
    ctx.strokeStyle = baseColor+"bb";
    // Animate with a slight cubic control
    let c1 = {x:cx+Math.sin((cy-pos.y)/180)*29, y:cy+(pos.y-cy)/2-Math.cos(i)*12};
    // If focused, highlight line
    if(clusterModalState.active && clusterModalState.focusIdx==i) ctx.shadowColor="#fcf9ff88",ctx.shadowBlur=19;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.bezierCurveTo(c1.x,c1.y, pos.x-10,pos.y-10, pos.x, pos.y+nodeR/2-3+Math.sin(mindmapAnimPhase+i*2)*3.14);
    ctx.stroke();
    ctx.closePath();
    ctx.restore();
  }
  // Connect some clusters together (not all: organic selection)
  let cc = [[0,1],[1,2],[3,4],[0,3],[2,4]];
  for(const [a,b] of cc){
    ctx.save();
    if(clusterModalState.active && (a!==clusterModalState.focusIdx && b!==clusterModalState.focusIdx)) continue;
    let pa=clusterPositions[a], pb=clusterPositions[b];
    ctx.strokeStyle=CLUSTERS[a].color+"7c";
    ctx.globalAlpha=0.33+0.09*Math.cos(Date.now()/1175+a*1.2-b*4.13);
    ctx.lineWidth=2.4 + Math.sin(mindmapAnimPhase*.99+a+b)*0.7;
    ctx.beginPath();
    ctx.moveTo(pa.x,pa.y);
    // organic 'pip curve'
    let mx = (pa.x+pb.x)/2 + Math.sin(mindmapAnimPhase+a*1.7-b)*25;
    let my = (pa.y+pb.y)/2 + Math.cos(mindmapAnimPhase+a*3.1+b)*22;
    ctx.quadraticCurveTo(mx,my,pb.x,pb.y);
    ctx.stroke();
    ctx.closePath();
    ctx.restore();
  }

}
function animateMindMapLines() {
  mindmapAnimPhase+=0.012 * (1+(clusterModalState.active?0.31:0.00));
  renderMindMapLines();
  requestAnimationFrame(animateMindMapLines);
}
animateMindMapLines();

/* --- Cluster Node Interaction --- */
let hoveredNodeIdx = null;
function setHoveredNode(idx) {
  hoveredNodeIdx = idx;
  const nodes = mindmapUI.querySelectorAll('.cluster-node');
  for(let i=0;i<nodes.length;i++) {
    if(clusterModalState.active) {
      // Modal: only focused node is visible, rest fade
      if(i !== clusterModalState.focusIdx)
        nodes[i].classList.add('inactive');
      else
        nodes[i].classList.add('focused');
      continue;
    }
    // No modal: shift outward on hover
    nodes[i].classList.remove('focused', 'inactive');
    if(idx===i) {
      nodes[i].style.transform="scale(1.14) translateY(-7px)";
      nodes[i].style.filter="brightness(1.31) drop-shadow(0 2px 16px "+CLUSTERS[i].color+"33)";
      nodes[i].style.zIndex=17;
    } else {
      nodes[i].style.transform='';
      nodes[i].style.filter='';
      nodes[i].style.zIndex='';
    }
  }
}
mindmapUI.addEventListener('pointerleave', ()=>setHoveredNode(null));

/* --- Cluster Modal Zoom / Spotlight System --- */
const clusterModalBg = document.getElementById('cluster-modal-bg');
const clusterModalBox = document.getElementById('cluster-modal-box');
let clusterModalState = {
  active: false,
  focusIdx: null,
  camZoom: 1,
  camPan: {x:0,y:0},
  ani: 0,
  closing: false
};

function playSound(id) {
  const el = document.getElementById("sfx-"+id);
  if(!el) return;
  const play = ()=>{
    el.currentTime = 0;
    el.muted = !(window._soundEnabled===true);
    el.volume = 0.14;
    el.play();
  };
  setTimeout(play,60+Math.random()*60);
}

function zoomCluster(idx) {
  if(clusterModalState.active && clusterModalState.focusIdx === idx) return;
  clusterModalState.active = true;
  clusterModalState.focusIdx = idx;
  clusterModalState.closing = false;
  clusterModalBox.innerHTML = '';
  clusterModalBg.classList.add('active');
  setTimeout(()=>{
    clusterModalBox.classList.add('active');
    clusterModalBox.setAttribute('aria-hidden','false');
    renderClusterModalContent(idx);
    setHoveredNode(null);
    positionClusterNodes();
    renderMindMapLines();
  },40);
  setHoveredNode(idx);
  playSound(CLUSTERS[idx].sound);
  document.body.style.overflow="hidden";
}
function closeClusterModal() {
  if(!clusterModalState.active) return;
  clusterModalState.active = false;
  clusterModalState.closing=true;
  clusterModalBox.classList.remove('active');
  clusterModalBg.classList.remove('active');
  clusterModalBox.setAttribute('aria-hidden','true');
  setTimeout(()=>{
    clusterModalBox.style.visibility='hidden';
    clusterModalBox.innerHTML='';
    setHoveredNode(null);
    positionClusterNodes();
    renderMindMapLines();
    clusterModalState.focusIdx=null;
    document.body.style.overflow="";
    clusterModalState.closing=false;
  },333);
}
clusterModalBg.addEventListener('click', (e)=> {
  // Only if outside modal box
  if(e.target === clusterModalBg) closeClusterModal();
});
window.addEventListener('keydown', (e)=>{
  if(clusterModalState.active && (e.key==='Escape' || e.key==='Esc')) {
    e.preventDefault(); closeClusterModal();
  }
});
clusterModalBox.addEventListener('keydown',(e)=>{
  if(clusterModalState.active && (e.key==='Escape' || e.key==='Esc')) {
    e.preventDefault(); closeClusterModal();
  }
});

function renderClusterModalContent(idx) {
  let box = clusterModalBox;
  box.style.visibility='visible';
  box.focus();
  const c = CLUSTERS[idx];
  // Glass/parallax background
  box.innerHTML = `<div class="parallax-bg"></div>
    <button class="modal-close-btn" aria-label="Back" tabindex="0">&times;</button>
    <div class="cluster-modal-content">${clusterModalZoomContent(idx)}</div>
    `;
  box.querySelector('.modal-close-btn').onclick=closeClusterModal;
  box.querySelector('.modal-close-btn').onkeydown=e=>{
    if(e.key===' '||e.key==='Enter'){e.preventDefault();closeClusterModal();}
  }
  box.setAttribute('tabindex','0');
  box.onkeydown=(e)=>{
    if(e.key==='Escape'||e.key==='Esc') closeClusterModal();
  };
  // Parallax subtle movement on mouse/touchmove
  let pbg = box.querySelector('.parallax-bg');
  function animParallax(e) {
    let x=0,y=0;
    if(e.touches && e.touches.length) {
      let t = e.touches[0];
      x=t.clientX; y=t.clientY;
    } else if (e instanceof MouseEvent) {
      x=e.clientX; y=e.clientY;
    } else {
      x=window.innerWidth/2;
      y=window.innerHeight/2;
    }
    let dx = (x-window.innerWidth/2)/window.innerWidth;
    let dy = (y-window.innerHeight/2)/window.innerHeight;
    pbg.style.transform=`translate(${dx*22}px,${dy*19}px) scale(1.04)`;
  }
  box.onpointermove = animParallax;
  box.ontouchmove = animParallax;
  box.onpointerleave = ()=>{pbg.style.transform="";}
}
function crossZoomCluster(idx) {
  // Transition from open modal to another node
  if(!clusterModalState.active) {zoomCluster(idx);return;}
  clusterModalState.focusIdx=idx;
  clusterModalBox.classList.remove('active');
  setTimeout(()=>{
    clusterModalBox.innerHTML = '';
    clusterModalBox.classList.add('active');
    renderClusterModalContent(idx);
    positionClusterNodes();
    renderMindMapLines();
  },190+Math.random()*49);
  setHoveredNode(idx);
  playSound(CLUSTERS[idx].sound);
}

/* --- Cluster Modal Content for Each Project --- */
function clusterModalZoomContent(idx) {
  switch(idx) {
    case 0: // GlglStats
      return `<div class="cluster-modal-main">
        <div class="cmc-col cmc-shrink cmc-center cmc-pad">
          <div class="waveform-bg" id="gs-waveform"></div>
        </div>
        <div class="cmc-col cmc-stretch cmc-middle cmc-pad">
          <div class="cmc-title">GlglStats</div>
          <div class="cmc-desc">A Python project exploring Israeli pop-song repetitiveness using LZ77 compression and visualization.</div>
        </div>
        <div class="cmc-col cmc-shrink cmc-center cmc-pad">
          <a class="cmc-link" href="https://glglstats.onrender.com/" target="_blank" rel="noopener">Live site</a>
          <div class="cmc-video-preview" title="Conference Presentation" tabindex="0">
            <video src="https://www.youtube.com/embed/jrKAtOsj1Lo?autoplay=0&mute=1" width="140" height="87" muted loop preload="none" style="width:140px;height:87px;object-fit:cover;background:#142045;" poster="https://i.ytimg.com/vi/jrKAtOsj1Lo/hqdefault.jpg"></video>
            <div class="play-overlay">&#9658;</div>
          </div>
        </div>
      </div>`;
    case 1: // Ahuzat Dibuk
      return `<div class="cluster-modal-main">
        <div class="cmc-col cmc-shrink cmc-center cmc-pad">
          <div class="mini-map">
            <img src="https://i.imgur.com/21RMLv5.png" width="132" height="86" alt="Tel-Aviv Parking Map" style="width:100%;height:100%;object-fit:cover;object-position:center;"/>
            <div class="heat-fade"></div>
            <div class="mini-map-fade-border"></div>
          </div>
        </div>
        <div class="cmc-col cmc-stretch cmc-middle cmc-pad">
          <div class="cmc-title">Ahuzat Dibuk</div>
          <div class="cmc-desc">Scraping and mapping real-time Tel-Aviv parking lot data so residents find a spot—for less stress, less circling.</div>
          <div class="news-links">
          <a class="news-icon-link" href="https://13tv.co.il/item/news/domestic/internal/parking-902956407/" target="_blank" rel="noopener" title="13TV News">
            <svg width="20" height="20" viewBox="0 0 25 25"><circle cx="12.5" cy="12.5" r="11" fill="#fff"/><text x="12.5" y="16.5" text-anchor="middle" font-size="15" fill="#3a69ba" font-family="Arial" dy="0">13</text></svg>
          </a>
          <a class="news-icon-link" href="https://www.mako.co.il/nexter-news/Article-ae43964b891bf71027.htm" target="_blank" rel="noopener" title="MAKO News">
            <svg width="24" height="24" viewBox="0 0 24 24"><rect width="24" height="24" rx="5" fill="#0edbfa"/><text x="12" y="17" text-anchor="middle" font-size="14" fill="#242455" font-family="Arial" dy="0">MAKO</text></svg>
          </a>
          <a class="news-icon-link" href="https://www.facebook.com/groups/secrettelaviv/posts/10159636301195943" target="_blank" rel="noopener" title="Secret Tel Aviv">
            <svg width="22" height="22" viewBox="0 0 22 22"><circle cx="11" cy="11" r="10.1" fill="#3b5998"/><text x="11" y="16" text-anchor="middle" font-size="10.5" fill="#fff" font-family="Arial" dy="0">STLV</text></svg>
          </a>
          </div>
          <a class="fb-link" href="https://www.facebook.com/groups/secrettelaviv/posts/10159636301195943" target="_blank" rel="noopener">
            <svg class="fb-icon" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14.3" fill="#4088ff" opacity="0.87"/>
              <path d="M20.73 17.5l.55-3.6h-3.39v-2.34c0-1.02.49-2.01 2.06-2.01h1.6v-2.48s-1.45-.25-2.84-.25c-2.89 0-4.78 1.58-4.78 4.44v2.64h-3.2v3.6h3.2v8.71a14 14 0 0 0 4.11 0V17.5z" fill="#fff"/>
            </svg>
            See publication
          </a>
        </div>
      </div>`;
    case 2: // 2D Part Orienting
      return `<div class="cluster-modal-main">
        <div class="svg-mesh-bg">
          <svg width="98" height="98" viewBox="0 0 98 98">
            <g stroke="#41f6aa30" stroke-width="2">
              <polyline points="16,16 82,16 82,82 16,82 16,16" fill="none"/>
              <polyline points="16,49 82,49" fill="none"/><polyline points="49,16 49,82" fill="none"/>
            </g>
            <g stroke="#a8e6ff" stroke-width="2.7" >
              <polyline points="21,42 41,61 55,52 65,64 78,36" fill="none"/>
            </g>
            <rect x="31" y="33" width="16" height="16" rx="2.7" fill="#28ffde19" />
          </svg>
        </div>
        <div class="cmc-col cmc-middle cmc-pad" style="max-width:330px;">
          <div class="cmc-title">2D Part Orienting</div>
          <div class="cmc-desc">Open-source C++ for efficient polygon orienting, part of a global geometry toolkit.</div>
          <a href="https://www.cgl.cs.tau.ac.il/projects/2d-part-orienting/" target="_blank" class="proj-arrow-link" title="Project website">
            <svg width="31" height="31" viewBox="0 0 31 31">
              <g><rect x="8" y="7.5" width="15" height="4" rx="1.7" fill="#2beff1"/><polygon points="25,10 19,7 19,13" fill="#beffeb"/></g>
              <rect x="4" y="21" width="13" height="2.4" rx="1" fill="#bffbff" opacity="0.7"/>
            </svg>
            See code
          </a>
        </div>
      </div>`;
    case 3: // Portfolio Site (meta)
      return `<div class="cluster-modal-main">
      <div class="portfolio-mini-window">
        <svg class="portfolio-mini-mindmap" viewBox="0 0 58 58">
          <circle cx="29" cy="29" r="14" fill="#e3fbff" stroke="#372b7a" stroke-width="1" />
          <circle cx="25" cy="11" r="5" fill="#89e3ff" stroke="#fff" stroke-width="0.7"/>
          <circle cx="47" cy="26" r="4.5" fill="#be8fff" stroke="#fff" stroke-width="1"/>
          <circle cx="36" cy="47" r="5" fill="#7bffea" stroke="#fff" stroke-width="1"/>
          <circle cx="11" cy="35" r="5.9" fill="#95ceff" stroke="#fff" stroke-width="1"/>
          <circle cx="39" cy="10" r="2.2" fill="#c2fefa" stroke="#fff" stroke-width="0.7"/>
          <path d="M29 15 V29" stroke="#9e78ff" stroke-width="2.5" opacity="0.5"/>
          <path d="M25 11 C29 23, 39 10, 39 10" stroke="#76f3ff" stroke-width="1.6" opacity="0.5"/>
          <path d="M29 29 Q38 33, 36 47" stroke="#72ffee" stroke-width="1.6" opacity="0.7"/>
          <path d="M11 35 Q20 22, 25 11" stroke="#9ad2ff" stroke-width="1.5" opacity="0.41"/>
        </svg>
      </div>
      <div class="cmc-col cmc-middle cmc-pad">
        <div class="cmc-title">Portfolio Site (meta!)</div>
        <div class="meta-desc">This site redesigns itself; here’s the original version I spun off from…</div>
        <a class="meta-link" href="https://portfolio-dor1.onrender.com/" target="_blank" rel="noopener">Reference site</a>
      </div>
      </div>`;
    case 4: // Contact
      return `<div style="flex:1 1 0;position:relative;">
        <div class="pulse-bg"></div>
        <div class="contact-card">
          <div class="cmc-title" style="margin-bottom:0.24em;">Contact</div>
          <div class="contact-row">
            <a class="contact-btn" href="https://github.com/gevak" target="_blank" rel="noopener">
              <svg width="23" height="23" viewBox="0 0 23 23" style="margin-right:0.2em;"><g>
                <circle cx="11.5" cy="11.5" r="11" fill="#f5ffff" stroke="#3c839a"/>
                <path d="M10.9,18.6c-1.1,0.2-1.5-0.5-1.5-1c0-0.2,0-0.8,0-1.7c-6.3,1-7.6-2.7-7.6-2.7C1,11.8,0.5,10.8,0.5,10.8  C-0.2,9.6,0.7,9.6,0.7,9.6c1.2,0.0,1.9,1.2,1.9,1.2c1.0,1.8,2.7,1.3,3.3,1c0.1-0.7,0.4-1.3,0.7-1.6c-5.1-0.6-6.2-2.6-6.2-4.9  c0-1.1,0.4-2.0,1.1-2.8c-0.1-0.2-0.5-1.3,0.1-2.7c0,0,1.0-0.3,3.3,1.1c1-0.3,2-0.4,3.0-0.4c1.0,0.0,2.1,0.1,3.0,0.4  c2.3-1.4,3.3-1.1,3.3-1.1c0.7,1.4,0.3,2.5,0.1,2.7c0.8,0.8,1.1,1.7,1.1,2.8c0,2.3-1.1,4.3-6.2,4.9c0.4,0.3,0.7,1.0,0.7,2.0  c0,1.4,0,2.5,0,2.8c0,0.5-0.4,1.2-1.6,1C18.3,18.4,17.5,16.4,16.3,17.2z" fill="#234266"/></g></svg>
              GitHub
            </a>
            <a class="contact-btn" href="https://linkedin.com/in/gevakip" target="_blank" rel="noopener">
              <svg width="22" height="22" viewBox="0 0 24 24"><g>
                <rect x="1" y="1" width="22" height="22" rx="5" fill="#def6ff" stroke="#347ad3"/>
                <path d="M6,7.5a2,2 0 1,0 0.1,0ZM16 10.8c-1.3,0-1.6,0.7-1.7,1.2V11H11v7h3.3v-4c0-1.5,2-1.4,2,0v4H20v-4.8c0-2.6-2.1-4.3-4-4.3Z" fill="#225389"/>
              </g></svg>
              LinkedIn
            </a>
            <a class="contact-btn" href="https://facebook.com/geva.kipper" target="_blank" rel="noopener">
              <svg width="22" height="22" viewBox="0 0 32 32"><circle cx="16" cy="16" r="15" fill="#60aaff"/><path d="M20.73 17.5l.55-3.6h-3.39v-2.34c0-1.02.49-2.01 2.06-2.01h1.6v-2.48s-1.45-.25-2.84-.25c-2.89 0-4.78 1.58-4.78 4.44v2.64h-3.2v3.6h3.2v8.71a14 14 0 0 0 4.11 0V17.5z" fill="#fff"/></svg>
              Facebook
            </a>
          </div>
        </div>
      </div>`;
    default: return '';
  }
}

clusterModalBox.addEventListener("click",function(e){
  if (e.target.classList.contains("proj-arrow-link"))
    playSound("swip");
})
clusterModalBox.addEventListener("keydown",function(e){
  if (e.target.classList.contains("proj-arrow-link"))
    playSound("swip");
})
// GlglStats live preview video/modal
clusterModalBox.addEventListener('click', function(e){
  let t = e.target.closest('.cmc-video-preview');
  if(!t) return;
  showVideoModal('https://www.youtube.com/embed/jrKAtOsj1Lo');
});
function showVideoModal(yturl) {
  // Modal overlay, closes on click/esc.
  let div = document.createElement('div');
  div.style = 'position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:120;background:rgba(20,28,54,0.88);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);';
  div.tabIndex=0; div.setAttribute('aria-modal','true');
  let box = document.createElement('div');
  box.style = "background:#0a171d;padding:0;border-radius:19px;box-shadow:0 6px 54px #7acefaf6;overflow:hidden;max-width:94vw;max-height:92vh;position:relative;"
  box.innerHTML=`<iframe src="${yturl}?autoplay=1&rel=0" width="800" height="450" allow="autoplay; fullscreen" frameborder="0" style="border-radius:19px;border:none;max-width:96vw;max-height:92vh;aspect-ratio:16/9" allowfullscreen></iframe>
    <button aria-label="Close video" style="position:absolute;right:19px;top:13px;width:35px;height:35px;border-radius:50%;background:#fff4;font-size:1.5em;cursor:pointer;border:none;z-index:20;">&times;</button>
  `;
  div.appendChild(box);
  document.body.appendChild(div);
  box.querySelector('button').onclick=()=>div.remove();
  div.onclick = e=>{ if(e.target===div)div.remove();};
  div.onkeydown=e=>{if(e.key==="Escape")div.remove();};
  setTimeout(()=>{div.focus();},80);
}

/* --- Simulate waveform for GlglStats modal (pretend "LZ77" energy) --- */
function animateWaveformBG() {
  let wf = document.getElementById('gs-waveform');
  if(!wf) {requestAnimationFrame(animateWaveformBG);return;}
  // Width/height fixed by CSS
  wf.innerHTML='<svg width="126" height="96" viewBox="0 0 126 96"></svg>';
  let svg = wf.querySelector('svg');
  let N=37;
  let t = Date.now()/900 + Math.cos(Date.now()/1687)*0.45;
  let p = [];
  for(let i=0;i<N;i++) {
    let x=i/(N-1)*120+2;
    let amp = Math.sin(i*0.18+t)*8 + Math.cos(i*0.31-t*0.7)*11;
    let y = 48 + amp + Math.sin(i+255+t*1.19)*7;
    p.push([x,y]);
  }
  let pathD = "M"+p.map(xy=>xy.join(",")).join(" L ");
  svg.innerHTML=`<path d="${pathD}" stroke="#9dff8a" stroke-width="3.1" fill="none" opacity="0.61"/>`;
  for(let i=0;i<N;i+=4){
    svg.innerHTML+=`<circle cx="${p[i][0]}" cy="${p[i][1]}" r="1.4" fill="#fff8" opacity="0.5"/>`;
  }
  requestAnimationFrame(animateWaveformBG);
}
new MutationObserver(()=> animateWaveformBG()).observe(clusterModalBox,{subtree:true,childList:true});

/* --- Stopwatch counter (live since 2025-04-15 04:38:36) --- */
const portfoliostart = new Date('2025-04-15T04:38:36Z');
const stopwatchEl = document.getElementById('corner-stopwatch');
function pad(n,l=2){return n.toString().padStart(l,'0');}
function showStopwatch() {
  let now = new Date();
  let diff = Math.floor((now-portfoliostart)/1000);
  if(diff<0) diff=0;
  let days = Math.floor(diff/(60*60*24));
  let hrs = Math.floor((diff-days*86400)/3600);
  let mins = Math.floor((diff-days*86400-hrs*3600)/60);
  let secs = diff%60;
  let ms = now.getMilliseconds();
  stopwatchEl.textContent = 
    `${days}d ${pad(hrs)}:${pad(mins)}:${pad(secs)}.${pad(Math.floor(ms/10),2)}`;
}
setInterval(showStopwatch,70);
showStopwatch();

/* --- *Organic* daily node rotation/positioning flux (AI-generated redesign) --- */
function fluxDailyNodes() {
  // Each day, randomize cluster positions/colors slightly
  updateClusterPositions();
  positionClusterNodes();
  renderMindMapLines();
  // Randomly swap morphString every few hours
  if(Math.random()<0.07) morphSubtitle();
  // Future: accent color can adapt here for daily evolution (not implemented)
}
setInterval(fluxDailyNodes, 1000*60*17);


/* --- Accessibility/Focus --- */
mindmapUI.addEventListener('keydown',(e)=>{
  const n = parseInt(e.target.getAttribute('data-idx'),10);
  if(e.key==="ArrowRight"||e.key==="ArrowDown") {
    e.preventDefault();
    let nextIdx = (n+1)%CLUSTERS.length;
    mindmapUI.querySelectorAll('.cluster-node')[nextIdx].focus();
  }
  if(e.key==="ArrowLeft"||e.key==="ArrowUp") {
    e.preventDefault();
    let prevIdx = (n-1+CLUSTERS.length)%CLUSTERS.length;
    mindmapUI.querySelectorAll('.cluster-node')[prevIdx].focus();
  }
});

/* --- Initial daily shuffle to start "AI redesign" --- */
fluxDailyNodes();

/* --- Mobile/resize --- */
window.addEventListener('resize',()=>{
  fluxDailyNodes();
})

/* --- Sound enable toggle (muted by default) --- */
window._soundEnabled = false;
document.body.addEventListener('keydown', function(e){
  if((e.key==='m'||e.key==='M') && (e.ctrlKey||e.metaKey)) {
    window._soundEnabled = !window._soundEnabled;
    document.querySelectorAll("audio").forEach(el=>el.muted=!window._soundEnabled);
    if(window._soundEnabled) playSound("note");
  }
});

</script>
<!-- Add this block to embed the like button -->
    <script src="/static/js/like_button.js"></script>
    <script>
        LikeButton.init({
          pageId: "20250415",
          position: "bottom-right", // Options: bottom-right, bottom-left, top-right, top-left
        });
    </script>

</body>
</html>